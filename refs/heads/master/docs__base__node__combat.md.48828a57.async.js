(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[67],{"/kxs":function(e,n,t){"use strict";t.r(n);var a=t("q1tI"),r=t.n(a),o=t("dEAq"),s=t("H1Ra");t("JjdP");n["default"]=e=>(r.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h1",{id:"node-\u5b9e\u6218"},r.a.createElement(o["AnchorLink"],{to:"#node-\u5b9e\u6218","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"node \u5b9e\u6218"),r.a.createElement("h2",{id:"1\u5165\u53e3\u6587\u4ef6"},r.a.createElement(o["AnchorLink"],{to:"#1\u5165\u53e3\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"1.\u5165\u53e3\u6587\u4ef6"),r.a.createElement(s["a"],{code:"// node\u81ea\u5e26\nconst fs = require('fs');\nconst https = require('https');\nconst http = require('http');\n\n// \u5916\u90e8npm\nconst Koa = require('koa');\nconst cors = require('koa2-cors');\nconst response = require('./middlewares/response');\nconst koaBody = require('koa-body');\nconst bodyParser = require('koa-bodyparser');\n\n// \u914d\u7f6e\nconst config = require('./config');\nconst env = process.env.NODE_ENV;\n\n// \u521b\u5efa\u5b9e\u4f8b\nconst app = new Koa();\n\n// \u540c\u6b65\u8bfb\u53d6\u5bc6\u94a5\u548c\u7b7e\u540d\u8bc1\u4e66\nconst options = {\n  key: fs.readFileSync('./server/index.key'),\n  cert: fs.readFileSync('./server/index.crt'),\n};\n\n// \u5b9a\u4e49server\nconst httpsServer = https.createServer(options, app.callback());\nconst httpServer = http.createServer(app.callback());\n\n// \u89e3\u6790body\napp.use(koaBody({ multipart: true }));\n\n// \u89e3\u51b3\u8de8\u57df\napp.use(cors());\n\n// \u4f7f\u7528\u54cd\u5e94\u5904\u7406\u4e2d\u95f4\u4ef6\napp.use(response);\n\n// \u89e3\u6790\u8bf7\u6c42\u4f53\napp.use(bodyParser());\n\n// \u5f15\u5165\u8def\u7531\u5206\u53d1\nconst router = require('./routes');\napp.use(router.routes());\n\n// https\u76d1\u542c3000\u7aef\u53e3\nhttpsServer.listen(config[env].https);\n\n// http\u76d1\u542c3003\u7aef\u53e3\nhttpServer.listen(config[env].http);",lang:"js"}),r.a.createElement("h2",{id:"2\u5c01\u88c5\u4e2d\u95f4\u4ef6"},r.a.createElement(o["AnchorLink"],{to:"#2\u5c01\u88c5\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"2.\u5c01\u88c5\u4e2d\u95f4\u4ef6"),r.a.createElement(s["a"],{code:"/**\n * \u54cd\u5e94\u5904\u7406\u6a21\u5757\n */\nmodule.exports = async function (ctx, next) {\n  try {\n    // \u8c03\u7528\u4e0b\u4e00\u4e2a middleware\n    await next();\n\n    // \u5904\u7406\u54cd\u5e94\u7ed3\u679c\n    // \u5982\u679c\u76f4\u63a5\u5199\u5165\u5728 body \u4e2d\uff0c\u5219\u4e0d\u4f5c\u5904\u7406\n    // \u5982\u679c\u5199\u5728 ctx.body \u4e3a\u7a7a\uff0c\u5219\u4f7f\u7528 state \u4f5c\u4e3a\u54cd\u5e94\n    ctx.body = ctx.body ? ctx.body : Object.assign({}, ctx.state, { code: 0 });\n  } catch (e) {\n    // catch \u4f4f\u5168\u5c40\u7684\u9519\u8bef\u4fe1\u606f\n\n    // \u8bbe\u7f6e\u72b6\u6001\u7801\u4e3a 200 - \u670d\u52a1\u7aef\u9519\u8bef\n    ctx.status = 200;\n\n    let error = '\u51fa\u9519\u5566';\n    if (e) {\n      if (e.message) {\n        error = e.message;\n      } else if (typeof e === 'string') {\n        error = e;\n      } else {\n        error = e.toString();\n      }\n    }\n\n    // \u8f93\u51fa\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f\n    ctx.body = Object.assign({}, ctx.state, { error });\n  }\n};",lang:"js"}),r.a.createElement("h2",{id:"3pm2-\u8fd0\u884c"},r.a.createElement(o["AnchorLink"],{to:"#3pm2-\u8fd0\u884c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"3.pm2 \u8fd0\u884c"),r.a.createElement(s["a"],{code:"pm2 start processes.json",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"processes.json")),r.a.createElement(s["a"],{code:'{\n  "apps": [\n    {\n      "name": "projectname",\n      "script": "app.js",\n      "cwd": "./",\n      "exec_mode": "fork",\n      "watch": true,\n      "ignore_watch": ["tmp"],\n      "env": {\n        "NODE_ENV": "production"\n      },\n      "engines": {\n        "node": ">=7.6"\n      }\n    }\n  ]\n}',lang:"json"}))))},JjdP:function(e,n,t){"use strict";t.r(n),n["default"]={}},Zs1V:function(e){e.exports=JSON.parse("{}")}}]);