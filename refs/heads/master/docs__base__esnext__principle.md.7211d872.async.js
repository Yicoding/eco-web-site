(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{"2esP":function(e,n,t){"use strict";t.r(n);var r=t("q1tI"),l=t.n(r),a=t("dEAq"),o=t("H1Ra");t("JjdP");n["default"]=e=>(l.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&a["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("h1",{id:"promiseasyncgenerator-\u5b9e\u73b0\u539f\u7406\u89e3\u6790"},l.a.createElement(a["AnchorLink"],{to:"#promiseasyncgenerator-\u5b9e\u73b0\u539f\u7406\u89e3\u6790","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"Promise/async/Generator \u5b9e\u73b0\u539f\u7406\u89e3\u6790"),l.a.createElement("h2",{id:"1promise"},l.a.createElement(a["AnchorLink"],{to:"#1promise","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1.Promise"),l.a.createElement("h3",{id:"1\u89c2\u5bdf\u8005\u6a21\u5f0f"},l.a.createElement(a["AnchorLink"],{to:"#1\u89c2\u5bdf\u8005\u6a21\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u89c2\u5bdf\u8005\u6a21\u5f0f"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,l.a.createElement("code",null,"\u6536\u96c6\u4f9d\u8d56")," -> ",l.a.createElement("code",null,"\u89e6\u53d1\u901a\u77e5")," -> ",l.a.createElement("code",null,"\u53d6\u51fa\u4f9d\u8d56\u6267\u884c")," \u7684\u65b9\u5f0f\uff0c\u88ab\u5e7f\u6cdb\u8fd0\u7528\u4e8e",l.a.createElement("code",null,"\u89c2\u5bdf\u8005\u6a21\u5f0f"),"\u7684\u5b9e\u73b0")),l.a.createElement("li",null,l.a.createElement("p",null,"\u5728 Promise \u91cc\uff0c\u6267\u884c\u987a\u5e8f\u662f ",l.a.createElement("code",null,"then \u6536\u96c6\u4f9d\u8d56")," -> ",l.a.createElement("code",null,"\u5f02\u6b65\u89e6\u53d1 resolve")," -> ",l.a.createElement("code",null,"resolve \u6267\u884c\u4f9d\u8d56")),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"Promise")," \u7684\u6784\u9020\u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a ",l.a.createElement("code",null,"executor()"),"\uff0c\u5728 ",l.a.createElement("code",null,"new Promise()"),"\u65f6\u5c31\u7acb\u523b\u6267\u884c\u8fd9\u4e2a ",l.a.createElement("code",null,"executor")," \u56de\u8c03"),l.a.createElement("li",null,l.a.createElement("code",null,"executor()"),"\u5185\u90e8\u7684\u5f02\u6b65\u4efb\u52a1\u88ab\u653e\u5165",l.a.createElement("code",null,"\u5b8f/\u5fae\u4efb\u52a1\u961f\u5217"),"\uff0c\u7b49\u5f85\u6267\u884c"),l.a.createElement("li",null,l.a.createElement("code",null,"then()"),"\u88ab\u6267\u884c\uff0c\u6536\u96c6",l.a.createElement("code",null,"\u6210\u529f/\u5931\u8d25\u56de\u8c03"),"\uff0c\u653e\u5165\u6210\u529f/\u5931\u8d25\u961f\u5217"),l.a.createElement("li",null,l.a.createElement("code",null,"executor()"),"\u7684\u5f02\u6b65\u4efb\u52a1\u88ab\u6267\u884c\uff0c\u89e6\u53d1 resolve/reject\uff0c\u4ece\u6210\u529f/\u5931\u8d25\u961f\u5217\u4e2d\u53d6\u51fa\u56de\u8c03\u4f9d\u6b21\u6267\u884c")))),l.a.createElement(o["a"],{code:"class MyPromise {\n  // \u6784\u9020\u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\n  constructor(executor) {\n    this._resolveQueue = []; // then\u6536\u96c6\u7684\u6267\u884c\u6210\u529f\u7684\u56de\u8c03\u961f\u5217\n    this._rejectQueue = []; // then\u6536\u96c6\u7684\u6267\u884c\u5931\u8d25\u7684\u56de\u8c03\u961f\u5217\n\n    // \u7531\u4e8eresolve/reject\u662f\u5728executor\u5185\u90e8\u88ab\u8c03\u7528, \u56e0\u6b64\u9700\u8981\u4f7f\u7528\u7bad\u5934\u51fd\u6570\u56fa\u5b9athis\u6307\u5411, \u5426\u5219\u627e\u4e0d\u5230this._resolveQueue\n    let _resolve = (val) => {\n      // \u4ece\u6210\u529f\u961f\u5217\u91cc\u53d6\u51fa\u56de\u8c03\u4f9d\u6b21\u6267\u884c\n      while (this._resolveQueue.length) {\n        const callback = this._resolveQueue.shift();\n        callback(val);\n      }\n    };\n    // \u5b9e\u73b0\u540cresolve\n    let _reject = (val) => {\n      while (this._rejectQueue.length) {\n        const callback = this._rejectQueue.shift();\n        callback(val);\n      }\n    };\n    // new Promise()\u65f6\u7acb\u5373\u6267\u884cexecutor,\u5e76\u4f20\u5165resolve\u548creject\n    executor(_resolve, _reject);\n  }\n\n  // then\u65b9\u6cd5,\u63a5\u6536\u4e00\u4e2a\u6210\u529f\u7684\u56de\u8c03\u548c\u4e00\u4e2a\u5931\u8d25\u7684\u56de\u8c03\uff0c\u5e76push\u8fdb\u5bf9\u5e94\u961f\u5217\n  then(resolveFn, rejectFn) {\n    this._resolveQueue.push(resolveFn);\n    this._rejectQueue.push(rejectFn);\n  }\n}\n\nconst p1 = new MyPromise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('result');\n  }, 1000);\n});\np1.then((res) => console.log(res));\n//\u4e00\u79d2\u540e\u8f93\u51faresult",lang:"js"}),l.a.createElement("h3",{id:"2promise-a\u89c4\u8303"},l.a.createElement(a["AnchorLink"],{to:"#2promise-a\u89c4\u8303","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09Promise A+\u89c4\u8303"),l.a.createElement("ul",null,l.a.createElement("li",null,"Promise \u672c\u8d28\u662f\u4e00\u4e2a\u72b6\u6001\u673a\uff0c\u4e14\u72b6\u6001\u53ea\u80fd\u4e3a\u4ee5\u4e0b\u4e09\u79cd\uff1a",l.a.createElement("code",null,"Pending\uff08\u7b49\u5f85\u6001\uff09"),"\u3001",l.a.createElement("code",null,"Fulfilled\uff08\u6267\u884c\u6001\uff09"),"\u3001",l.a.createElement("code",null,"Rejected\uff08\u62d2\u7edd\u6001\uff09"),"\uff0c\u72b6\u6001\u7684\u53d8\u66f4\u662f\u5355\u5411\u7684\uff0c\u53ea\u80fd\u4ece Pending -> Fulfilled \u6216 Pending -> Rejected\uff0c",l.a.createElement("code",null,"\u72b6\u6001\u53d8\u66f4\u4e0d\u53ef\u9006")),l.a.createElement("li",null,"then \u65b9\u6cd5\u63a5\u6536",l.a.createElement("code",null,"\u4e24\u4e2a\u53ef\u9009\u53c2\u6570"),"\uff0c\u5206\u522b\u5bf9\u5e94\u72b6\u6001\u6539\u53d8\u65f6\u89e6\u53d1\u7684\u56de\u8c03\u3002then \u65b9\u6cd5",l.a.createElement("code",null,"\u8fd4\u56de\u4e00\u4e2a promise"),"\u3002then \u65b9\u6cd5\u53ef\u4ee5\u88ab\u540c\u4e00\u4e2a promise \u8c03\u7528\u591a\u6b21\u3002",l.a.createElement("ul",null,l.a.createElement("li",null,"then \u4e2d return \u8fd4\u56de\u7684\u503c\u624d\u80fd\u88ab\u4e0b\u4e00\u4e2a then \u4f7f\u7528")))),l.a.createElement(o["a"],{code:"// Promise/A+\u89c4\u8303\u7684\u4e09\u79cd\u72b6\u6001\nconst PENDING = 'pending';\nconst FULFILLED = 'fulfilled';\nconst REJECTED = 'rejected';\n\nclass MyPromise {\n  // \u6784\u9020\u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\n  constructor(executor) {\n    this._status = PENDING; // Promise\u72b6\u6001\n    this._resolveQueue = []; // \u6210\u529f\u961f\u5217, resolve\u65f6\u89e6\u53d1\n    this._rejectQueue = []; // \u5931\u8d25\u961f\u5217, reject\u65f6\u89e6\u53d1\n\n    // \u7531\u4e8eresolve/reject\u662f\u5728executor\u5185\u90e8\u88ab\u8c03\u7528, \u56e0\u6b64\u9700\u8981\u4f7f\u7528\u7bad\u5934\u51fd\u6570\u56fa\u5b9athis\u6307\u5411, \u5426\u5219\u627e\u4e0d\u5230this._resolveQueue\n    let _resolve = (val) => {\n      if (this._status !== PENDING) return; // \u5bf9\u5e94\u89c4\u8303\u4e2d\u7684\"\u72b6\u6001\u53ea\u80fd\u7531pending\u5230fulfilled\u6216rejected\"\n      this._status = FULFILLED; // \u53d8\u66f4\u72b6\u6001\n\n      // \u8fd9\u91cc\u4e4b\u6240\u4ee5\u4f7f\u7528\u4e00\u4e2a\u961f\u5217\u6765\u50a8\u5b58\u56de\u8c03,\u662f\u4e3a\u4e86\u5b9e\u73b0\u89c4\u8303\u8981\u6c42\u7684 \"then \u65b9\u6cd5\u53ef\u4ee5\u88ab\u540c\u4e00\u4e2a promise \u8c03\u7528\u591a\u6b21\"\n      // \u5982\u679c\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u800c\u975e\u961f\u5217\u6765\u50a8\u5b58\u56de\u8c03,\u90a3\u4e48\u5373\u4f7f\u591a\u6b21p1.then()\u4e5f\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\u56de\u8c03\n      while (this._resolveQueue.length) {\n        const callback = this._resolveQueue.shift();\n        callback(val);\n      }\n    };\n    // \u5b9e\u73b0\u540cresolve\n    let _reject = (val) => {\n      if (this._status !== PENDING) return; // \u5bf9\u5e94\u89c4\u8303\u4e2d\u7684\"\u72b6\u6001\u53ea\u80fd\u7531pending\u5230fulfilled\u6216rejected\"\n      this._status = REJECTED; // \u53d8\u66f4\u72b6\u6001\n      while (this._rejectQueue.length) {\n        const callback = this._rejectQueue.shift();\n        callback(val);\n      }\n    };\n    // new Promise()\u65f6\u7acb\u5373\u6267\u884cexecutor,\u5e76\u4f20\u5165resolve\u548creject\n    executor(_resolve, _reject);\n  }\n\n  // then\u65b9\u6cd5,\u63a5\u6536\u4e00\u4e2a\u6210\u529f\u7684\u56de\u8c03\u548c\u4e00\u4e2a\u5931\u8d25\u7684\u56de\u8c03\n  then(resolveFn, rejectFn) {\n    this._resolveQueue.push(resolveFn);\n    this._rejectQueue.push(rejectFn);\n  }\n}",lang:"js"}),l.a.createElement("h3",{id:"3then-\u7684\u94fe\u5f0f\u8c03\u7528"},l.a.createElement(a["AnchorLink"],{to:"#3then-\u7684\u94fe\u5f0f\u8c03\u7528","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09then \u7684\u94fe\u5f0f\u8c03\u7528"),l.a.createElement(o["a"],{code:"const p1 = new Promise((resolve, reject) => {\n  resolve(1);\n});\n\np1.then((res) => {\n  console.log(res);\n  // then\u56de\u8c03\u4e2d\u53ef\u4ee5return\u4e00\u4e2aPromise\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve(2);\n    }, 1000);\n  });\n})\n  .then((res) => {\n    console.log(res);\n    // then\u56de\u8c03\u4e2d\u4e5f\u53ef\u4ee5return\u4e00\u4e2a\u503c\n    return 3;\n  })\n  .then((res) => {\n    console.log(res);\n  });",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,".then()"),"\u9700\u8981\u8fd4\u56de\u4e00\u4e2a ",l.a.createElement("code",null,"Promise"),"\uff0c\u8fd9\u6837\u624d\u80fd\u627e\u5230 then \u65b9\u6cd5\uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u628a then \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5305\u88c5\u6210 Promise\u3002"),l.a.createElement("li",null,".then()\u7684\u56de\u8c03\u9700\u8981\u62ff\u5230",l.a.createElement("code",null,"\u4e0a\u4e00\u4e2a.then()\u7684\u8fd4\u56de\u503c")),l.a.createElement("li",null,".then()\u7684\u56de\u8c03\u9700\u8981\u987a\u5e8f\u6267\u884c\uff0c\u4ee5\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u4e3a\u4f8b\uff0c\u867d\u7136\u4e2d\u95f4 return \u4e86\u4e00\u4e2a Promise\uff0c\u4f46\u6267\u884c\u987a\u5e8f\u4ecd\u8981\u4fdd\u8bc1\u662f 1->2->3\u3002\u6211\u4eec\u8981\u7b49\u5f85\u5f53\u524d Promise \u72b6\u6001\u53d8\u66f4\u540e\uff0c\u518d\u6267\u884c\u4e0b\u4e00\u4e2a then \u6536\u96c6\u7684\u56de\u8c03\uff0c\u8fd9\u5c31\u8981\u6c42\u6211\u4eec\u5bf9 then \u7684\u8fd4\u56de\u503c\u5206\u7c7b\u8ba8\u8bba")),l.a.createElement(o["a"],{code:"// then\u65b9\u6cd5,\u63a5\u6536\u4e00\u4e2a\u6210\u529f\u7684\u56de\u8c03\u548c\u4e00\u4e2a\u5931\u8d25\u7684\u56de\u8c03\nthen(resolveFn, rejectFn) {\n  // return\u4e00\u4e2a\u65b0\u7684promise\n  return new MyPromise((resolve, reject) => {\n    //\u628aresolveFn\u91cd\u65b0\u5305\u88c5\u4e00\u4e0b,\u518dpush\u8fdbresolve\u6267\u884c\u961f\u5217,\u8fd9\u662f\u4e3a\u4e86\u80fd\u591f\u83b7\u53d6\u56de\u8c03\u7684\u8fd4\u56de\u503c\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\n    const fulfilledFn = (value) => {\n      try {\n        // \u6267\u884c\u7b2c\u4e00\u4e2a(\u5f53\u524d\u7684)Promise\u7684\u6210\u529f\u56de\u8c03,\u5e76\u83b7\u53d6\u8fd4\u56de\u503c\n        let x = resolveFn(value);\n        // \u5206\u7c7b\u8ba8\u8bba\u8fd4\u56de\u503c,\u5982\u679c\u662fPromise,\u90a3\u4e48\u7b49\u5f85Promise\u72b6\u6001\u53d8\u66f4,\u5426\u5219\u76f4\u63a5resolve\n        // \u8fd9\u91ccresolve\u4e4b\u540e\uff0c\u5c31\u80fd\u88ab\u4e0b\u4e00\u4e2a.then()\u7684\u56de\u8c03\u83b7\u53d6\u5230\u8fd4\u56de\u503c\uff0c\u4ece\u800c\u5b9e\u73b0\u94fe\u5f0f\u8c03\u7528\n        x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n      } catch (error) {\n        reject(error);\n      }\n    };\n    // \u628a\u540e\u7eedthen\u6536\u96c6\u7684\u4f9d\u8d56\u90fdpush\u8fdb\u5f53\u524dPromise\u7684\u6210\u529f\u56de\u8c03\u961f\u5217\u4e2d(_rejectQueue), \u8fd9\u662f\u4e3a\u4e86\u4fdd\u8bc1\u987a\u5e8f\u8c03\u7528\n    this._resolveQueue.push(fulfilledFn);\n\n    // reject\u540c\u7406\n    const rejectedFn = (error) => {\n      try {\n        let x = rejectFn(error);\n        x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n      } catch (error) {\n        reject(error);\n      }\n    };\n    this._rejectQueue.push(rejectedFn);\n  });\n}",lang:"js"}),l.a.createElement("h3",{id:"4\u503c\u7a7f\u900f--\u72b6\u6001\u5df2\u53d8\u66f4\u7684\u60c5\u51b5"},l.a.createElement(a["AnchorLink"],{to:"#4\u503c\u7a7f\u900f--\u72b6\u6001\u5df2\u53d8\u66f4\u7684\u60c5\u51b5","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4\uff09\u503c\u7a7f\u900f & \u72b6\u6001\u5df2\u53d8\u66f4\u7684\u60c5\u51b5"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"\u503c\u7a7f\u900f"),"\uff1a\u6839\u636e\u89c4\u8303\uff0c\u5982\u679c then() \u63a5\u6536\u7684\u53c2\u6570\u4e0d\u662f function\uff0c\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u5ffd\u7565\u5b83\u3002\u5982\u679c\u6ca1\u6709\u5ffd\u7565\uff0c\u5f53 then()\u56de\u8c03\u4e0d\u4e3a function \u65f6\u5c06\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u5bfc\u81f4\u94fe\u5f0f\u8c03\u7528\u4e2d\u65ad"),l.a.createElement("li",null,l.a.createElement("code",null,"\u5904\u7406\u72b6\u6001\u4e3aresolve/reject\u7684\u60c5\u51b5"),"\uff1a\u5176\u5b9e\u6211\u4eec\u4e0a\u8fb9 then() \u7684\u5199\u6cd5\u662f\u5bf9\u5e94\u72b6\u6001\u4e3a pedding \u7684\u60c5\u51b5\uff0c\u4f46\u662f\u6709\u4e9b\u65f6\u5019\uff0cresolve/reject \u5728 then() \u4e4b\u524d\u5c31\u88ab\u6267\u884c\uff08\u6bd4\u5982 Promise.resolve().then()\uff09\uff0c\u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u8fd8\u628a then()\u56de\u8c03 push \u8fdb resolve/reject \u7684\u6267\u884c\u961f\u5217\u91cc\uff0c\u90a3\u4e48\u56de\u8c03\u5c06\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u56e0\u6b64\u5bf9\u4e8e\u72b6\u6001\u5df2\u7ecf\u53d8\u4e3a fulfilled \u6216 rejected \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u76f4\u63a5\u6267\u884c then \u56de\u8c03\uff1a")),l.a.createElement(o["a"],{code:"// then\u65b9\u6cd5,\u63a5\u6536\u4e00\u4e2a\u6210\u529f\u7684\u56de\u8c03\u548c\u4e00\u4e2a\u5931\u8d25\u7684\u56de\u8c03\nthen(resolveFn, rejectFn) {\n  // \u6839\u636e\u89c4\u8303\uff0c\u5982\u679cthen\u7684\u53c2\u6570\u4e0d\u662ffunction\uff0c\u5219\u6211\u4eec\u9700\u8981\u5ffd\u7565\u5b83, \u8ba9\u94fe\u5f0f\u8c03\u7528\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\n  typeof resolveFn !== 'function' ? (resolveFn = (value) => value) : null;\n  typeof rejectFn !== 'function'\n    ? (rejectFn = (reason) => {\n        throw new Error(reason instanceof Error ? reason.message : reason);\n      })\n    : null;\n\n  // return\u4e00\u4e2a\u65b0\u7684promise\n  return new MyPromise((resolve, reject) => {\n    // \u628aresolveFn\u91cd\u65b0\u5305\u88c5\u4e00\u4e0b,\u518dpush\u8fdbresolve\u6267\u884c\u961f\u5217,\u8fd9\u662f\u4e3a\u4e86\u80fd\u591f\u83b7\u53d6\u56de\u8c03\u7684\u8fd4\u56de\u503c\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\n    const fulfilledFn = (value) => {\n      try {\n        // \u6267\u884c\u7b2c\u4e00\u4e2a(\u5f53\u524d\u7684)Promise\u7684\u6210\u529f\u56de\u8c03,\u5e76\u83b7\u53d6\u8fd4\u56de\u503c\n        let x = resolveFn(value);\n        // \u5206\u7c7b\u8ba8\u8bba\u8fd4\u56de\u503c,\u5982\u679c\u662fPromise,\u90a3\u4e48\u7b49\u5f85Promise\u72b6\u6001\u53d8\u66f4,\u5426\u5219\u76f4\u63a5resolve\n        x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n      } catch (error) {\n        reject(error);\n      }\n    };\n\n    // reject\u540c\u7406\n    const rejectedFn = (error) => {\n      try {\n        let x = rejectFn(error);\n        x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n      } catch (error) {\n        reject(error);\n      }\n    };\n\n    switch (this._status) {\n      // \u5f53\u72b6\u6001\u4e3apending\u65f6,\u628athen\u56de\u8c03push\u8fdbresolve/reject\u6267\u884c\u961f\u5217,\u7b49\u5f85\u6267\u884c\n      case PENDING:\n        this._resolveQueue.push(fulfilledFn);\n        this._rejectQueue.push(rejectedFn);\n        break;\n      // \u5f53\u72b6\u6001\u5df2\u7ecf\u53d8\u4e3aresolve/reject\u65f6,\u76f4\u63a5\u6267\u884cthen\u56de\u8c03\n      case FULFILLED:\n        fulfilledFn(this._value); // this._value\u662f\u4e0a\u4e00\u4e2athen\u56de\u8c03return\u7684\u503c(\u89c1\u5b8c\u6574\u7248\u4ee3\u7801)\n        break;\n      case REJECTED:\n        rejectedFn(this._value);\n        break;\n    }\n  });\n}",lang:"js"}),l.a.createElement("h3",{id:"5\u517c\u5bb9\u540c\u6b65\u4efb\u52a1"},l.a.createElement(a["AnchorLink"],{to:"#5\u517c\u5bb9\u540c\u6b65\u4efb\u52a1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5\uff09\u517c\u5bb9\u540c\u6b65\u4efb\u52a1"),l.a.createElement("ul",null,l.a.createElement("li",null,"Promise \u7684\u6267\u884c\u987a\u5e8f\u662f ",l.a.createElement("code",null,"new Promise -> then()\u6536\u96c6\u56de\u8c03 -> resolve/reject \u6267\u884c\u56de\u8c03"),"\uff0c\u8fd9\u4e00\u987a\u5e8f\u662f\u5efa\u7acb\u5728 executor \u662f\u5f02\u6b65\u4efb\u52a1\u7684\u524d\u63d0\u4e0a\u7684\uff0c\u5982\u679c executor \u662f\u4e00\u4e2a\u540c\u6b65\u4efb\u52a1\uff0c\u90a3\u4e48\u987a\u5e8f\u5c31\u4f1a\u53d8\u6210 ",l.a.createElement("code",null,"new Promise -> resolve/reject \u6267\u884c\u56de\u8c03 -> then()\u6536\u96c6\u56de\u8c03"),"\uff0cresolve \u7684\u6267\u884c\u8dd1\u5230 then \u4e4b\u524d\u53bb\u4e86\uff0c\u4e3a\u4e86\u517c\u5bb9\u8fd9\u79cd\u60c5\u51b5\uff0c\u9700\u8981\u7ed9 ",l.a.createElement("code",null,"resolve/reject")," \u6267\u884c\u56de\u8c03\u7684\u64cd\u4f5c\u5305\u4e00\u4e2a ",l.a.createElement("code",null,"setTimeout\uff0c\u8ba9\u5b83\u5f02\u6b65\u6267\u884c"))),l.a.createElement("blockquote",null,l.a.createElement("p",null,"\u5176\u5b9e Promise \u7684\u9ed8\u8ba4\u5b9e\u73b0\u662f\u653e\u8fdb\u4e86\u5fae\u4efb\u52a1\u961f\u5217\uff0c\u8fd9\u91cc\u7684\u5b9e\u73b0\uff08\u5305\u62ec\u5927\u591a\u6570 Promise \u624b\u52a8\u5b9e\u73b0\u548c polyfill \u7684\u8f6c\u5316\uff09\u90fd\u662f\u4f7f\u7528 setTimeout \u653e\u5165\u4e86\u5b8f\u4efb\u52a1\u961f\u5217\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528 MutationObserver \u6a21\u62df\u5fae\u4efb\u52a1\uff09")),l.a.createElement(o["a"],{code:"//Promise/A+\u89c4\u5b9a\u7684\u4e09\u79cd\u72b6\u6001\nconst PENDING = 'pending';\nconst FULFILLED = 'fulfilled';\nconst REJECTED = 'rejected';\n\nclass MyPromise {\n  // \u6784\u9020\u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\n  constructor(executor) {\n    this._status = PENDING; // Promise\u72b6\u6001\n    this._value = undefined; // \u50a8\u5b58then\u56de\u8c03return\u7684\u503c\n    this._resolveQueue = []; // \u6210\u529f\u961f\u5217, resolve\u65f6\u89e6\u53d1\n    this._rejectQueue = []; // \u5931\u8d25\u961f\u5217, reject\u65f6\u89e6\u53d1\n\n    // \u7531\u4e8eresolve/reject\u662f\u5728executor\u5185\u90e8\u88ab\u8c03\u7528, \u56e0\u6b64\u9700\u8981\u4f7f\u7528\u7bad\u5934\u51fd\u6570\u56fa\u5b9athis\u6307\u5411, \u5426\u5219\u627e\u4e0d\u5230this._resolveQueue\n    let _resolve = (val) => {\n      //\u628aresolve\u6267\u884c\u56de\u8c03\u7684\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u51fd\u6570,\u653e\u8fdbsetTimeout\u91cc,\u4ee5\u517c\u5bb9executor\u662f\u540c\u6b65\u4ee3\u7801\u7684\u60c5\u51b5\n      const run = () => {\n        if (this._status !== PENDING) return; // \u5bf9\u5e94\u89c4\u8303\u4e2d\u7684\"\u72b6\u6001\u53ea\u80fd\u7531pending\u5230fulfilled\u6216rejected\"\n        this._status = FULFILLED; // \u53d8\u66f4\u72b6\u6001\n        this._value = val; // \u50a8\u5b58\u5f53\u524dvalue\n\n        // \u8fd9\u91cc\u4e4b\u6240\u4ee5\u4f7f\u7528\u4e00\u4e2a\u961f\u5217\u6765\u50a8\u5b58\u56de\u8c03,\u662f\u4e3a\u4e86\u5b9e\u73b0\u89c4\u8303\u8981\u6c42\u7684 \"then \u65b9\u6cd5\u53ef\u4ee5\u88ab\u540c\u4e00\u4e2a promise \u8c03\u7528\u591a\u6b21\"\n        // \u5982\u679c\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u800c\u975e\u961f\u5217\u6765\u50a8\u5b58\u56de\u8c03,\u90a3\u4e48\u5373\u4f7f\u591a\u6b21p1.then()\u4e5f\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\u56de\u8c03\n        while (this._resolveQueue.length) {\n          const callback = this._resolveQueue.shift();\n          callback(val);\n        }\n      };\n      setTimeout(run);\n    };\n    // \u5b9e\u73b0\u540cresolve\n    let _reject = (val) => {\n      const run = () => {\n        if (this._status !== PENDING) return; // \u5bf9\u5e94\u89c4\u8303\u4e2d\u7684\"\u72b6\u6001\u53ea\u80fd\u7531pending\u5230fulfilled\u6216rejected\"\n        this._status = REJECTED; // \u53d8\u66f4\u72b6\u6001\n        this._value = val; // \u50a8\u5b58\u5f53\u524dvalue\n        while (this._rejectQueue.length) {\n          const callback = this._rejectQueue.shift();\n          callback(val);\n        }\n      };\n      setTimeout(run);\n    };\n    // new Promise()\u65f6\u7acb\u5373\u6267\u884cexecutor,\u5e76\u4f20\u5165resolve\u548creject\n    executor(_resolve, _reject);\n  }\n\n  // then\u65b9\u6cd5,\u63a5\u6536\u4e00\u4e2a\u6210\u529f\u7684\u56de\u8c03\u548c\u4e00\u4e2a\u5931\u8d25\u7684\u56de\u8c03\n  then(resolveFn, rejectFn) {\n    // \u6839\u636e\u89c4\u8303\uff0c\u5982\u679cthen\u7684\u53c2\u6570\u4e0d\u662ffunction\uff0c\u5219\u6211\u4eec\u9700\u8981\u5ffd\u7565\u5b83, \u8ba9\u94fe\u5f0f\u8c03\u7528\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\n    typeof resolveFn !== 'function' ? (resolveFn = (value) => value) : null;\n    typeof rejectFn !== 'function'\n      ? (rejectFn = (reason) => {\n          throw new Error(reason instanceof Error ? reason.message : reason);\n        })\n      : null;\n\n    // return\u4e00\u4e2a\u65b0\u7684promise\n    return new MyPromise((resolve, reject) => {\n      // \u628aresolveFn\u91cd\u65b0\u5305\u88c5\u4e00\u4e0b,\u518dpush\u8fdbresolve\u6267\u884c\u961f\u5217,\u8fd9\u662f\u4e3a\u4e86\u80fd\u591f\u83b7\u53d6\u56de\u8c03\u7684\u8fd4\u56de\u503c\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\n      const fulfilledFn = (value) => {\n        try {\n          // \u6267\u884c\u7b2c\u4e00\u4e2a(\u5f53\u524d\u7684)Promise\u7684\u6210\u529f\u56de\u8c03,\u5e76\u83b7\u53d6\u8fd4\u56de\u503c\n          let x = resolveFn(value);\n          // \u5206\u7c7b\u8ba8\u8bba\u8fd4\u56de\u503c,\u5982\u679c\u662fPromise,\u90a3\u4e48\u7b49\u5f85Promise\u72b6\u6001\u53d8\u66f4,\u5426\u5219\u76f4\u63a5resolve\n          x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n        } catch (error) {\n          reject(error);\n        }\n      };\n\n      // reject\u540c\u7406\n      const rejectedFn = (error) => {\n        try {\n          let x = rejectFn(error);\n          x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n        } catch (error) {\n          reject(error);\n        }\n      };\n\n      switch (this._status) {\n        // \u5f53\u72b6\u6001\u4e3apending\u65f6,\u628athen\u56de\u8c03push\u8fdbresolve/reject\u6267\u884c\u961f\u5217,\u7b49\u5f85\u6267\u884c\n        case PENDING:\n          this._resolveQueue.push(fulfilledFn);\n          this._rejectQueue.push(rejectedFn);\n          break;\n        // \u5f53\u72b6\u6001\u5df2\u7ecf\u53d8\u4e3aresolve/reject\u65f6,\u76f4\u63a5\u6267\u884cthen\u56de\u8c03\n        case FULFILLED:\n          fulfilledFn(this._value); // this._value\u662f\u4e0a\u4e00\u4e2athen\u56de\u8c03return\u7684\u503c(\u89c1\u5b8c\u6574\u7248\u4ee3\u7801)\n          break;\n        case REJECTED:\n          rejectedFn(this._value);\n          break;\n      }\n    });\n  }\n}",lang:"js"}),l.a.createElement("h3",{id:"6\u5b9e\u73b0-promiseprototypecatch"},l.a.createElement(a["AnchorLink"],{to:"#6\u5b9e\u73b0-promiseprototypecatch","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"6\uff09\u5b9e\u73b0 Promise.prototype.catch()"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"catch()"),"\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a Promise\uff0c\u5e76\u4e14\u5904\u7406\u62d2\u7edd\u7684\u60c5\u51b5\u3002\u5b83\u7684\u884c\u4e3a\u4e0e\u8c03\u7528 Promise.prototype.then(undefined, onRejected) \u76f8\u540c\u3002")),l.a.createElement(o["a"],{code:"// catch\u65b9\u6cd5\u5176\u5b9e\u5c31\u662f\u6267\u884c\u4e00\u4e0bthen\u7684\u7b2c\u4e8c\u4e2a\u56de\u8c03\ncatch(rejectFn) {\n  return this.then(undefined, rejectFn);\n}",lang:"js"}),l.a.createElement("h3",{id:"7\u5b9e\u73b0-promiseprototypefinally"},l.a.createElement(a["AnchorLink"],{to:"#7\u5b9e\u73b0-promiseprototypefinally","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7\uff09\u5b9e\u73b0 Promise.prototype.finally()"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"finally()"),"\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a Promise\u3002\u5728 promise \u7ed3\u675f\u65f6\uff0c\u65e0\u8bba\u7ed3\u679c\u662f fulfilled \u6216\u8005\u662f rejected\uff0c\u90fd\u4f1a\u6267\u884c\u6307\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u3002\u5728 finally \u4e4b\u540e\uff0c\u8fd8\u53ef\u4ee5\u7ee7\u7eed then\u3002\u5e76\u4e14\u4f1a\u5c06\u503c\u539f\u5c01\u4e0d\u52a8\u7684\u4f20\u9012\u7ed9\u540e\u9762\u7684 then")),l.a.createElement(o["a"],{code:"// finally\u65b9\u6cd5\nfinally(callback) {\n  return this.then(\n    value => MyPromise.resolve(callback()).then(() => value), // MyPromise.resolve\u6267\u884c\u56de\u8c03,\u5e76\u5728then\u4e2dreturn\u7ed3\u679c\u4f20\u9012\u7ed9\u540e\u9762\u7684Promise\n    reason => MyPromise.resolve(callback()).then(() => { throw reason }) // reject\u540c\u7406\n  )\n}",lang:"js"}),l.a.createElement("h3",{id:"8\u5b9e\u73b0-promiseresolve"},l.a.createElement(a["AnchorLink"],{to:"#8\u5b9e\u73b0-promiseresolve","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8\uff09\u5b9e\u73b0 Promise.resolve()"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"Promise.resolve(value)"),'\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u4ee5\u7ed9\u5b9a\u503c\u89e3\u6790\u540e\u7684 Promise \u5bf9\u8c61\u3002\u5982\u679c\u8be5\u503c\u4e3a promise\uff0c\u8fd4\u56de\u8fd9\u4e2a promise\uff1b\u5982\u679c\u8fd9\u4e2a\u503c\u662f thenable\uff08\u5373\u5e26\u6709"then" \u65b9\u6cd5)\uff09\uff0c\u8fd4\u56de\u7684 promise \u4f1a\u201c\u8ddf\u968f\u201d\u8fd9\u4e2a thenable \u7684\u5bf9\u8c61\uff0c\u91c7\u7528\u5b83\u7684\u6700\u7ec8\u72b6\u6001\uff1b\u5426\u5219\u8fd4\u56de\u7684 promise \u5c06\u4ee5\u6b64\u503c\u5b8c\u6210\u3002\u6b64\u51fd\u6570\u5c06\u7c7b promise \u5bf9\u8c61\u7684\u591a\u5c42\u5d4c\u5957\u5c55\u5e73')),l.a.createElement(o["a"],{code:"// \u9759\u6001\u7684resolve\u65b9\u6cd5\nstatic resolve(value) {\n  if(value instanceof MyPromise) return value; // \u6839\u636e\u89c4\u8303, \u5982\u679c\u53c2\u6570\u662fPromise\u5b9e\u4f8b, \u76f4\u63a5return\u8fd9\u4e2a\u5b9e\u4f8b\n  return new MyPromise(resolve => resolve(value));\n}",lang:"js"}),l.a.createElement("h3",{id:"9\u5b9e\u73b0-promisereject"},l.a.createElement(a["AnchorLink"],{to:"#9\u5b9e\u73b0-promisereject","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9\uff09\u5b9e\u73b0 Promise.reject()"),l.a.createElement("ul",null,l.a.createElement("li",null,"Promise.reject()\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709\u62d2\u7edd\u539f\u56e0\u7684 Promise \u5bf9\u8c61")),l.a.createElement(o["a"],{code:"// \u9759\u6001\u7684reject\u65b9\u6cd5\nstatic reject(reason) {\n  return new MyPromise((resolve, reject) => reject(reason));\n}",lang:"js"}),l.a.createElement("h3",{id:"9\u5b9e\u73b0-promiseall"},l.a.createElement(a["AnchorLink"],{to:"#9\u5b9e\u73b0-promiseall","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9\uff09\u5b9e\u73b0 Promise.all()"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"Promise.all(iterable)"),"\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a ",l.a.createElement("code",null,"Promise \u5b9e\u4f8b"),"\uff0c\u6b64\u5b9e\u4f8b\u5728 iterable \u53c2\u6570\u5185\u6240\u6709\u7684 promise \u90fd\u201c\u5b8c\u6210\uff08resolved\uff09\u201d\u6216\u53c2\u6570\u4e2d\u4e0d\u5305\u542b promise \u65f6\u56de\u8c03\u5b8c\u6210\uff08resolve\uff09\uff1b\u5982\u679c\u53c2\u6570\u4e2d promise \u6709\u4e00\u4e2a\u5931\u8d25\uff08rejected\uff09\uff0c\u6b64\u5b9e\u4f8b\u56de\u8c03\u5931\u8d25\uff08reject\uff09\uff0c\u5931\u8d25\u539f\u56e0\u7684\u662f\u7b2c\u4e00\u4e2a\u5931\u8d25 promise \u7684\u7ed3\u679c")),l.a.createElement(o["a"],{code:"// \u9759\u6001\u7684all\u65b9\u6cd5\nstatic all(promiseArr) {\n  let index = 0\n  let result = []\n  return new MyPromise((resolve, reject) => {\n    promiseArr.forEach((p, i) => {\n      // Promise.resolve(p)\u7528\u4e8e\u5904\u7406\u4f20\u5165\u503c\u4e0d\u4e3aPromise\u7684\u60c5\u51b5\n      MyPromise.resolve(p).then(\n        val => {\n          index++\n          result[i] = val\n          //\u6240\u6709then\u6267\u884c\u540e, resolve\u7ed3\u679c\n          if(index === promiseArr.length) {\n            resolve(result)\n          }\n        },\n        err => {\n          // \u6709\u4e00\u4e2aPromise\u88abreject\u65f6\uff0cMyPromise\u7684\u72b6\u6001\u53d8\u4e3areject\n          reject(err)\n        }\n      )\n    })\n  })\n}",lang:"js"}),l.a.createElement("h3",{id:"10\u5b9e\u73b0-promiserace"},l.a.createElement(a["AnchorLink"],{to:"#10\u5b9e\u73b0-promiserace","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"10\uff09\u5b9e\u73b0 Promise.race()"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"Promise.race(iterable)"),"\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a promise\uff0c\u4e00\u65e6\u8fed\u4ee3\u5668\u4e2d\u7684\u67d0\u4e2a promise \u89e3\u51b3\u6216\u62d2\u7edd\uff0c\u8fd4\u56de\u7684 promise \u5c31\u4f1a\u89e3\u51b3\u6216\u62d2\u7edd")),l.a.createElement("h3",{id:"11\u5b8c\u6574\u4ee3\u7801"},l.a.createElement(a["AnchorLink"],{to:"#11\u5b8c\u6574\u4ee3\u7801","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"11\uff09\u5b8c\u6574\u4ee3\u7801"),l.a.createElement(o["a"],{code:"// Promise/A+\u89c4\u5b9a\u7684\u4e09\u79cd\u72b6\u6001\nconst PENDING = 'pending';\nconst FULFILLED = 'fulfilled';\nconst REJECTED = 'rejected';\n\nclass MyPromise {\n  // \u6784\u9020\u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\n  constructor(executor) {\n    this._status = PENDING; // Promise\u72b6\u6001\n    this._value = undefined; // \u50a8\u5b58then\u56de\u8c03return\u7684\u503c\n    this._resolveQueue = []; // \u6210\u529f\u961f\u5217, resolve\u65f6\u89e6\u53d1\n    this._rejectQueue = []; // \u5931\u8d25\u961f\u5217, reject\u65f6\u89e6\u53d1\n\n    // \u7531\u4e8eresolve/reject\u662f\u5728executor\u5185\u90e8\u88ab\u8c03\u7528, \u56e0\u6b64\u9700\u8981\u4f7f\u7528\u7bad\u5934\u51fd\u6570\u56fa\u5b9athis\u6307\u5411, \u5426\u5219\u627e\u4e0d\u5230this._resolveQueue\n    let _resolve = (val) => {\n      // \u628aresolve\u6267\u884c\u56de\u8c03\u7684\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u51fd\u6570,\u653e\u8fdbsetTimeout\u91cc,\u4ee5\u517c\u5bb9executor\u662f\u540c\u6b65\u4ee3\u7801\u7684\u60c5\u51b5\n      const run = () => {\n        if (this._status !== PENDING) return; // \u5bf9\u5e94\u89c4\u8303\u4e2d\u7684\"\u72b6\u6001\u53ea\u80fd\u7531pending\u5230fulfilled\u6216rejected\"\n        this._status = FULFILLED; // \u53d8\u66f4\u72b6\u6001\n        this._value = val; // \u50a8\u5b58\u5f53\u524dvalue\n\n        // \u8fd9\u91cc\u4e4b\u6240\u4ee5\u4f7f\u7528\u4e00\u4e2a\u961f\u5217\u6765\u50a8\u5b58\u56de\u8c03,\u662f\u4e3a\u4e86\u5b9e\u73b0\u89c4\u8303\u8981\u6c42\u7684 \"then \u65b9\u6cd5\u53ef\u4ee5\u88ab\u540c\u4e00\u4e2a promise \u8c03\u7528\u591a\u6b21\"\n        // \u5982\u679c\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u800c\u975e\u961f\u5217\u6765\u50a8\u5b58\u56de\u8c03,\u90a3\u4e48\u5373\u4f7f\u591a\u6b21p1.then()\u4e5f\u53ea\u4f1a\u6267\u884c\u4e00\u6b21\u56de\u8c03\n        while (this._resolveQueue.length) {\n          const callback = this._resolveQueue.shift();\n          callback(val);\n        }\n      };\n      setTimeout(run);\n    };\n    // \u5b9e\u73b0\u540cresolve\n    let _reject = (val) => {\n      const run = () => {\n        if (this._status !== PENDING) return; // \u5bf9\u5e94\u89c4\u8303\u4e2d\u7684\"\u72b6\u6001\u53ea\u80fd\u7531pending\u5230fulfilled\u6216rejected\"\n        this._status = REJECTED; // \u53d8\u66f4\u72b6\u6001\n        this._value = val; // \u50a8\u5b58\u5f53\u524dvalue\n        while (this._rejectQueue.length) {\n          const callback = this._rejectQueue.shift();\n          callback(val);\n        }\n      };\n      setTimeout(run);\n    };\n    // new Promise()\u65f6\u7acb\u5373\u6267\u884cexecutor,\u5e76\u4f20\u5165resolve\u548creject\n    executor(_resolve, _reject);\n  }\n\n  // then\u65b9\u6cd5,\u63a5\u6536\u4e00\u4e2a\u6210\u529f\u7684\u56de\u8c03\u548c\u4e00\u4e2a\u5931\u8d25\u7684\u56de\u8c03\n  then(resolveFn, rejectFn) {\n    // \u6839\u636e\u89c4\u8303\uff0c\u5982\u679cthen\u7684\u53c2\u6570\u4e0d\u662ffunction\uff0c\u5219\u6211\u4eec\u9700\u8981\u5ffd\u7565\u5b83, \u8ba9\u94fe\u5f0f\u8c03\u7528\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\n    typeof resolveFn !== 'function' ? (resolveFn = (value) => value) : null;\n    typeof rejectFn !== 'function'\n      ? (rejectFn = (reason) => {\n          throw new Error(reason instanceof Error ? reason.message : reason);\n        })\n      : null;\n\n    // return\u4e00\u4e2a\u65b0\u7684promise\n    return new MyPromise((resolve, reject) => {\n      // \u628aresolveFn\u91cd\u65b0\u5305\u88c5\u4e00\u4e0b,\u518dpush\u8fdbresolve\u6267\u884c\u961f\u5217,\u8fd9\u662f\u4e3a\u4e86\u80fd\u591f\u83b7\u53d6\u56de\u8c03\u7684\u8fd4\u56de\u503c\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\n      const fulfilledFn = (value) => {\n        try {\n          // \u6267\u884c\u7b2c\u4e00\u4e2a(\u5f53\u524d\u7684)Promise\u7684\u6210\u529f\u56de\u8c03,\u5e76\u83b7\u53d6\u8fd4\u56de\u503c\n          let x = resolveFn(value);\n          // \u5206\u7c7b\u8ba8\u8bba\u8fd4\u56de\u503c,\u5982\u679c\u662fPromise,\u90a3\u4e48\u7b49\u5f85Promise\u72b6\u6001\u53d8\u66f4,\u5426\u5219\u76f4\u63a5resolve\n          x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n        } catch (error) {\n          reject(error);\n        }\n      };\n\n      // reject\u540c\u7406\n      const rejectedFn = (error) => {\n        try {\n          let x = rejectFn(error);\n          x instanceof MyPromise ? x.then(resolve, reject) : resolve(x);\n        } catch (error) {\n          reject(error);\n        }\n      };\n\n      switch (this._status) {\n        // \u5f53\u72b6\u6001\u4e3apending\u65f6,\u628athen\u56de\u8c03push\u8fdbresolve/reject\u6267\u884c\u961f\u5217,\u7b49\u5f85\u6267\u884c\n        case PENDING:\n          this._resolveQueue.push(fulfilledFn);\n          this._rejectQueue.push(rejectedFn);\n          break;\n        // \u5f53\u72b6\u6001\u5df2\u7ecf\u53d8\u4e3aresolve/reject\u65f6,\u76f4\u63a5\u6267\u884cthen\u56de\u8c03\n        case FULFILLED:\n          fulfilledFn(this._value); // this._value\u662f\u4e0a\u4e00\u4e2athen\u56de\u8c03return\u7684\u503c(\u89c1\u5b8c\u6574\u7248\u4ee3\u7801)\n          break;\n        case REJECTED:\n          rejectedFn(this._value);\n          break;\n      }\n    });\n  }\n\n  // catch\u65b9\u6cd5\u5176\u5b9e\u5c31\u662f\u6267\u884c\u4e00\u4e0bthen\u7684\u7b2c\u4e8c\u4e2a\u56de\u8c03\n  catch(rejectFn) {\n    return this.then(undefined, rejectFn);\n  }\n\n  // finally\u65b9\u6cd5\n  finally(callback) {\n    return this.then(\n      (value) => MyPromise.resolve(callback()).then(() => value), // \u6267\u884c\u56de\u8c03,\u5e76returnvalue\u4f20\u9012\u7ed9\u540e\u9762\u7684then\n      (reason) =>\n        MyPromise.resolve(callback()).then(() => {\n          throw reason;\n        }), // reject\u540c\u7406\n    );\n  }\n\n  // \u9759\u6001\u7684resolve\u65b9\u6cd5\n  static resolve(value) {\n    if (value instanceof MyPromise) return value; // \u6839\u636e\u89c4\u8303, \u5982\u679c\u53c2\u6570\u662fPromise\u5b9e\u4f8b, \u76f4\u63a5return\u8fd9\u4e2a\u5b9e\u4f8b\n    return new MyPromise((resolve) => resolve(value));\n  }\n\n  // \u9759\u6001\u7684reject\u65b9\u6cd5\n  static reject(reason) {\n    return new MyPromise((resolve, reject) => reject(reason));\n  }\n\n  // \u9759\u6001\u7684all\u65b9\u6cd5\n  static all(promiseArr) {\n    return new MyPromise((resolve, reject) => {\n      if (!Array.isArray(promiseArr)) {\n        return reject(new TypeError('arguments must be array'));\n      }\n      let index = 0;\n      let result = [];\n      promiseArr.forEach((p, i) => {\n        // Promise.resolve(p)\u7528\u4e8e\u5904\u7406\u4f20\u5165\u503c\u4e0d\u4e3aPromise\u7684\u60c5\u51b5\uff0c\u5f3a\u884c\u8f6c\u4e3apromise\uff0c\u907f\u514d\u4f7f\u7528 instanceof \u518d\u8fdb\u884c\u4e00\u6b21\u5224\u65ad\n        MyPromise.resolve(p).then(\n          (val) => {\n            index++;\n            result[i] = val;\n            if (index === promiseArr.length) {\n              resolve(result);\n            }\n            // \u9519\u8bef\u5199\u6cd5\n            // if (result.length === promiseArr.length)\n          },\n          (err) => {\n            reject(err);\n          },\n        );\n      });\n    });\n  }\n\n  // \u9759\u6001\u7684race\u65b9\u6cd5\n  static race(promiseArr) {\n    return new MyPromise((resolve, reject) => {\n      // \u540c\u65f6\u6267\u884cPromise,\u5982\u679c\u6709\u4e00\u4e2aPromise\u7684\u72b6\u6001\u53d1\u751f\u6539\u53d8,\u5c31\u53d8\u66f4\u65b0MyPromise\u7684\u72b6\u6001\n      for (let p of promiseArr) {\n        MyPromise.resolve(p).then(\n          // Promise.resolve(p)\u7528\u4e8e\u5904\u7406\u4f20\u5165\u503c\u4e0d\u4e3aPromise\u7684\u60c5\u51b5\n          (value) => {\n            resolve(value); // \u6ce8\u610f\u8fd9\u4e2aresolve\u662f\u4e0a\u8fb9new MyPromise\u7684\n          },\n          (err) => {\n            reject(err);\n          },\n        );\n      }\n    });\n  }\n}",lang:"js"}),l.a.createElement("h2",{id:"2asyncawait"},l.a.createElement(a["AnchorLink"],{to:"#2asyncawait","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.async/await"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"\u4f7f\u7528\u610f\u4e49"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5728\u591a\u4e2a\u56de\u8c03\u4f9d\u8d56\u7684\u573a\u666f\u4e2d\uff0c\u5c3d\u7ba1 Promise \u901a\u8fc7\u94fe\u5f0f\u8c03\u7528\u53d6\u4ee3\u4e86\u56de\u8c03\u5d4c\u5957\uff0c\u4f46\u8fc7\u591a\u7684\u94fe\u5f0f\u8c03\u7528\u53ef\u8bfb\u6027\u4ecd\u7136\u4e0d\u4f73\uff0c\u6d41\u7a0b\u63a7\u5236\u4e5f\u4e0d\u65b9\u4fbf"),l.a.createElement("li",null,"\u8ba9 JS \u5bf9\u4e8e",l.a.createElement("code",null,"\u5f02\u6b65\u64cd\u4f5c"),"\u6709\u4e86",l.a.createElement("code",null,"\u7ec8\u6781\u89e3\u51b3\u65b9\u6848")))),l.a.createElement("li",null,l.a.createElement("p",null,"\u539f\u7406"),l.a.createElement("ul",null,l.a.createElement("li",null,"async/await \u5b9e\u9645\u4e0a\u662f\u5bf9 ",l.a.createElement("code",null,"Generator"),"\uff08\u751f\u6210\u5668\uff09\u7684",l.a.createElement("code",null,"\u5c01\u88c5"))))),l.a.createElement("h3",{id:"1\u81ea\u52a8\u6267\u884c"},l.a.createElement(a["AnchorLink"],{to:"#1\u81ea\u52a8\u6267\u884c","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u81ea\u52a8\u6267\u884c"),l.a.createElement("ul",null,l.a.createElement("li",null,"run \u65b9\u6cd5\u91cc\u6211\u4eec\u628a\u6267\u884c\u4e0b\u4e00\u6b65\u7684\u64cd\u4f5c\u5c01\u88c5\u6210",l.a.createElement("code",null,"_next()"),"\uff0c\u6bcf\u6b21 Promise.then()\u7684\u65f6\u5019\u90fd\u53bb\u6267\u884c_next()\uff0c\u5b9e\u73b0\u81ea\u52a8\u8fed\u4ee3\u7684\u6548\u679c\u3002\u5728\u8fed\u4ee3\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u8fd8\u628a resolve \u7684\u503c\u4f20\u5165 ",l.a.createElement("code",null,"gen.next()"),"\uff0c\u4f7f\u5f97 yield \u5f97\u4ee5\u8fd4\u56de Promise \u7684 resolve \u7684\u503c")),l.a.createElement(o["a"],{code:"function run(gen) {\n  var g = gen(); //\u7531\u4e8e\u6bcf\u6b21gen()\u83b7\u53d6\u5230\u7684\u90fd\u662f\u6700\u65b0\u7684\u8fed\u4ee3\u5668,\u56e0\u6b64\u83b7\u53d6\u8fed\u4ee3\u5668\u64cd\u4f5c\u8981\u653e\u5728_next()\u4e4b\u524d,\u5426\u5219\u4f1a\u8fdb\u5165\u6b7b\u5faa\u73af\n\n  function _next(val) {\n    //\u5c01\u88c5\u4e00\u4e2a\u65b9\u6cd5, \u9012\u5f52\u6267\u884cg.next()\n    var res = g.next(val); //\u83b7\u53d6\u8fed\u4ee3\u5668\u5bf9\u8c61\uff0c\u5e76\u8fd4\u56deresolve\u7684\u503c\n    if (res.done) return res.value; //\u9012\u5f52\u7ec8\u6b62\u6761\u4ef6\n    res.value.then((val) => {\n      //Promise\u7684then\u65b9\u6cd5\u662f\u5b9e\u73b0\u81ea\u52a8\u8fed\u4ee3\u7684\u524d\u63d0\n      _next(val); //\u7b49\u5f85Promise\u5b8c\u6210\u5c31\u81ea\u52a8\u6267\u884c\u4e0b\u4e00\u4e2anext\uff0c\u5e76\u4f20\u5165resolve\u7684\u503c\n    });\n  }\n  _next(); //\u7b2c\u4e00\u6b21\u6267\u884c\n}\n\nfunction* myGenerator() {\n  console.log(yield Promise.resolve(1)); // 1\n  console.log(yield Promise.resolve(2)); // 2\n  console.log(yield Promise.resolve(3)); // 3\n}\n\nrun(myGenerator);",lang:"js"}),l.a.createElement("h3",{id:"2\u8fd4\u56de-promise--\u5f02\u5e38\u5904\u7406"},l.a.createElement(a["AnchorLink"],{to:"#2\u8fd4\u56de-promise--\u5f02\u5e38\u5904\u7406","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09\u8fd4\u56de Promise & \u5f02\u5e38\u5904\u7406"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u9700\u8981\u6539\u8fdb\u7684\u95ee\u9898",l.a.createElement("ul",null,l.a.createElement("li",null,"\u9700\u8981\u517c\u5bb9\u57fa\u672c\u7c7b\u578b\uff1a\u8fd9\u6bb5\u4ee3\u7801\u80fd\u81ea\u52a8\u6267\u884c\u7684\u524d\u63d0\u662f ",l.a.createElement("code",null,"yield")," \u540e\u9762\u8ddf Promise\uff0c\u4e3a\u4e86\u517c\u5bb9\u540e\u9762\u8ddf\u7740\u57fa\u672c\u7c7b\u578b\u503c\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u9700\u8981\u628a yield \u8ddf\u7684\u5185\u5bb9(",l.a.createElement("code",null,"gen().next.value"),")\u90fd\u7528 ",l.a.createElement("code",null,"Promise.resolve()"),"\u8f6c\u5316\u4e00\u904d"),l.a.createElement("li",null,"\u7f3a\u5c11\u9519\u8bef\u5904\u7406\uff1a\u4e0a\u8fb9\u4ee3\u7801\u91cc\u7684 Promise \u5982\u679c\u6267\u884c\u5931\u8d25\uff0c\u5c31\u4f1a\u5bfc\u81f4\u540e\u7eed\u6267\u884c\u76f4\u63a5\u4e2d\u65ad\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u8c03\u7528 ",l.a.createElement("code",null,"Generator.prototype.throw()"),"\uff0c\u628a\u9519\u8bef\u629b\u51fa\u6765\uff0c\u624d\u80fd\u88ab\u5916\u5c42\u7684 try-catch \u6355\u83b7\u5230"),l.a.createElement("li",null,"\u8fd4\u56de\u503c\u662f Promise\uff1a",l.a.createElement("code",null,"async/await")," \u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a Promise\uff0c\u6211\u4eec\u8fd9\u91cc\u4e5f\u9700\u8981\u4fdd\u6301\u4e00\u81f4\uff0c\u7ed9\u8fd4\u56de\u503c\u5305\u4e00\u4e2a Promise")))),l.a.createElement(o["a"],{code:"function run(gen) {\n  //\u628a\u8fd4\u56de\u503c\u5305\u88c5\u6210promise\n  return new Promise((resolve, reject) => {\n    var g = gen();\n\n    function _next(val) {\n      //\u9519\u8bef\u5904\u7406\n      try {\n        var res = g.next(val);\n      } catch (err) {\n        return reject(err);\n      }\n      if (res.done) {\n        return resolve(res.value);\n      }\n      //res.value\u5305\u88c5\u4e3apromise\uff0c\u4ee5\u517c\u5bb9yield\u540e\u9762\u8ddf\u57fa\u672c\u7c7b\u578b\u7684\u60c5\u51b5\n      Promise.resolve(res.value).then(\n        (val) => {\n          _next(val);\n        },\n        (err) => {\n          //\u629b\u51fa\u9519\u8bef\n          g.throw(err);\n        },\n      );\n    }\n    _next();\n  });\n}\n\nfunction* myGenerator() {\n  try {\n    console.log(yield Promise.resolve(1));\n    console.log(yield 2); //2\n    console.log(yield Promise.reject('error'));\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nconst result = run(myGenerator); //result\u662f\u4e00\u4e2aPromise\n//\u8f93\u51fa 1 2 error",lang:"js"}),l.a.createElement("h2",{id:"3generator"},l.a.createElement(a["AnchorLink"],{to:"#3generator","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3.Generator"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u751f\u6210\u5668\u51fd\u6570\u6839\u636e yield \u8bed\u53e5\u5c06\u4ee3\u7801\u5206\u5272\u4e3a switch-case \u5757\uff0c\u540e\u7eed\u901a\u8fc7\u5207\u6362_context.prev \u548c_context.next \u6765\u5206\u522b\u6267\u884c\u5404\u4e2a case")),l.a.createElement(o["a"],{code:"function* foo() {\n  yield 'result1';\n  yield 'result2';\n  yield 'result3';\n}\n\nconst gen = foo();\nconsole.log(gen.next().value); // result1\nconsole.log(gen.next().value); // result2\nconsole.log(gen.next().value); // result3",lang:"js"}),l.a.createElement("h3",{id:"1\u6838\u5fc3"},l.a.createElement(a["AnchorLink"],{to:"#1\u6838\u5fc3","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u6838\u5fc3"),l.a.createElement("ul",null,l.a.createElement("li",null,"Generator \u5b9e\u73b0\u7684\u6838\u5fc3\u5728\u4e8e",l.a.createElement("code",null,"\u4e0a\u4e0b\u6587\u7684\u4fdd\u5b58"),"\uff0c\u51fd\u6570\u5e76\u6ca1\u6709\u771f\u7684\u88ab\u6302\u8d77\uff0c\u6bcf\u4e00\u6b21 yield\uff0c\u5176\u5b9e\u90fd\u6267\u884c\u4e86\u4e00\u904d\u4f20\u5165\u7684\u751f\u6210\u5668\u51fd\u6570\uff0c\u53ea\u662f\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u95f4\u7528\u4e86\u4e00\u4e2a context \u5bf9\u8c61\u50a8\u5b58\u4e0a\u4e0b\u6587\uff0c\u4f7f\u5f97\u6bcf\u6b21\u6267\u884c\u751f\u6210\u5668\u51fd\u6570\u7684\u65f6\u5019\uff0c\u90fd\u53ef\u4ee5\u4ece\u4e0a\u4e00\u4e2a\u6267\u884c\u7ed3\u679c\u5f00\u59cb\u6267\u884c\uff0c\u770b\u8d77\u6765\u5c31\u50cf\u51fd\u6570\u88ab\u6302\u8d77\u4e86\u4e00\u6837")),l.a.createElement("h3",{id:"2\u5b9e\u73b0"},l.a.createElement(a["AnchorLink"],{to:"#2\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09\u5b9e\u73b0"),l.a.createElement(o["a"],{code:"// \u751f\u6210\u5668\u51fd\u6570\u6839\u636eyield\u8bed\u53e5\u5c06\u4ee3\u7801\u5206\u5272\u4e3aswitch-case\u5757\uff0c\u540e\u7eed\u901a\u8fc7\u5207\u6362_context.prev\u548c_context.next\u6765\u5206\u522b\u6267\u884c\u5404\u4e2acase\nfunction gen$(_context) {\n  while (1) {\n    switch ((_context.prev = _context.next)) {\n      case 0:\n        _context.next = 2;\n        return 'result1';\n\n      case 2:\n        _context.next = 4;\n        return 'result2';\n\n      case 4:\n        _context.next = 6;\n        return 'result3';\n\n      case 6:\n      case 'end':\n        return _context.stop();\n    }\n  }\n}\n\n// \u4f4e\u914d\u7248context\nvar context = {\n  next: 0,\n  prev: 0,\n  done: false,\n  stop: function stop() {\n    this.done = true;\n  },\n};\n\n// \u4f4e\u914d\u7248invoke\nlet gen = function () {\n  return {\n    next: function () {\n      value = context.done ? undefined : gen$(context);\n      done = context.done;\n      return {\n        value,\n        done,\n      };\n    },\n  };\n};\n\n// \u6d4b\u8bd5\u4f7f\u7528\nvar g = gen();\ng.next(); // {value: \"result1\", done: false}\ng.next(); // {value: \"result2\", done: false}\ng.next(); // {value: \"result3\", done: false}\ng.next(); // {value: undefined, done: true}",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"function* \u751f\u6210\u5668\u51fd\u6570\u88ab\u8f6c\u5316\u4e3a\u4ee5\u4e0a\u4ee3\u7801 \u8f6c\u5316\u540e\u7684\u4ee3\u7801\u5206\u4e3a\u4e09\u5927\u5757\uff1a"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"gen$(_context)"),"\u7531 yield \u5206\u5272\u751f\u6210\u5668\u51fd\u6570\u4ee3\u7801\u800c\u6765"),l.a.createElement("li",null,l.a.createElement("code",null,"context \u5bf9\u8c61"),"\u7528\u4e8e\u50a8\u5b58\u51fd\u6570\u6267\u884c\u4e0a\u4e0b\u6587"),l.a.createElement("li",null,l.a.createElement("code",null,"invoke()"),"\u65b9\u6cd5\u5b9a\u4e49 next()\uff0c\u7528\u4e8e\u6267\u884c gen$(_context)\u6765\u8df3\u5230\u4e0b\u4e00\u6b65"))),l.a.createElement("li",null,l.a.createElement("p",null,"\u8c03\u7528 g.next()\uff0c\u5c31\u76f8\u5f53\u4e8e\u8c03\u7528 invoke()\u65b9\u6cd5\uff0c\u6267\u884c gen$(_context)\uff0c\u8fdb\u5165 switch \u8bed\u53e5\uff0cswitch \u6839\u636e context \u7684\u6807\u8bc6\uff0c\u6267\u884c\u5bf9\u5e94\u7684 case \u5757\uff0creturn \u5bf9\u5e94\u7ed3\u679c")),l.a.createElement("li",null,l.a.createElement("p",null,"\u5f53\u751f\u6210\u5668\u51fd\u6570\u8fd0\u884c\u5230\u672b\u5c3e\uff08\u6ca1\u6709\u4e0b\u4e00\u4e2a yield \u6216\u5df2\u7ecf return\uff09\uff0cswitch \u5339\u914d\u4e0d\u5230\u5bf9\u5e94\u4ee3\u7801\u5757\uff0c\u5c31\u4f1a return \u7a7a\u503c\uff0c\u8fd9\u65f6 g.next()\u8fd4\u56de","{","value: undefined, done: true","}"))))))},JjdP:function(e,n,t){"use strict";t.r(n),n["default"]={}},Zs1V:function(e){e.exports=JSON.parse("{}")}}]);