(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[151],{Jb1r:function(e,n,t){"use strict";t.r(n);var a=t("q1tI"),l=t.n(a),r=t("dEAq"),o=t("H1Ra");t("JjdP");n["default"]=e=>(l.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&r["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("h1",{id:"\u72b6\u6001\u7ba1\u7406-mobx"},l.a.createElement(r["AnchorLink"],{to:"#\u72b6\u6001\u7ba1\u7406-mobx","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"\u72b6\u6001\u7ba1\u7406 mobx"),l.a.createElement("h2",{id:"1mobx-\u7279\u6027"},l.a.createElement(r["AnchorLink"],{to:"#1mobx-\u7279\u6027","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1.Mobx \u7279\u6027"),l.a.createElement("ul",null,l.a.createElement("li",null,"mobx-react \u63d0\u4f9b\u4e86 ",l.a.createElement("code",null,"HOC")," \uff0c\u53ef\u4ee5\u83b7\u53d6\u72b6\u6001\u7ba1\u7406 Mobx \u7684\u6570\u636e\u5c42\uff0c\u4e5f\u80fd\u63a5\u53d7 mobx \u6570\u636e\u6539\u53d8\u5e26\u6765\u7684\u66f4\u65b0")),l.a.createElement("h3",{id:"1\u89c2\u5bdf\u8005\u6a21\u5f0f"},l.a.createElement(r["AnchorLink"],{to:"#1\u89c2\u5bdf\u8005\u6a21\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u89c2\u5bdf\u8005\u6a21\u5f0f"),l.a.createElement("ul",null,l.a.createElement("li",null,"Mobx \u91c7\u7528\u4e86\u4e00\u79cd",l.a.createElement("code",null,"'\u89c2\u5bdf\u8005\u6a21\u5f0f'"),"\u2014\u2014",l.a.createElement("code",null,"Observer"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"ObserverValue"),"\uff1a\u5728 mobx \u7684\u72b6\u6001\u5c42\uff0c\u6bcf\u4e00\u4e2a\u9700\u8981\u89c2\u5bdf\u7684",l.a.createElement("code",null,"\u5c5e\u6027"),"\u90fd\u4f1a",l.a.createElement("code",null,"\u6dfb\u52a0"),"\u4e00\u4e2a",l.a.createElement("code",null,"\u89c2\u5bdf\u8005")),l.a.createElement("li",null,l.a.createElement("code",null,"\u6536\u96c6 listener"),"\uff1amobx \u4e2d Reaction \u6a21\u5757\uff0c\u53ef\u4ee5\u5bf9\u4e00\u4e9b\u884c\u4e3a\u505a\u4f9d\u8d56\u6536\u96c6\uff0c\u5728 React \u4e2d\uff0c\u662f\u901a\u8fc7",l.a.createElement("code",null,"\u52ab\u6301 render \u51fd\u6570"),"\u6267\u884c\u884c\u4e3a\uff0c\u8fdb\u884c\u7684\u4f9d\u8d56\u6536\u96c6"),l.a.createElement("li",null,"\u7528\u81ea\u5b9a\u4e49\u5b58\u53d6\u5668\u5c5e\u6027\u4e2d\u7684 ",l.a.createElement("code",null,"get")," \u548c ",l.a.createElement("code",null,"set")," \uff0c\u6765\u8fdb\u884c\u7684",l.a.createElement("code",null,"\u4f9d\u8d56\u6536\u96c6"),"\u548c",l.a.createElement("code",null,"\u66f4\u65b0\u6d3e\u53d1"),"\uff0c\u5f53\u72b6\u6001\u6539\u53d8\uff0c\u89c2\u5bdf\u8005\u4f1a\u76f4\u63a5\u7cbe\u786e\u901a\u77e5\u6bcf\u4e2a listener")))),l.a.createElement("h3",{id:"2\u72b6\u6001\u63d0\u5347"},l.a.createElement(r["AnchorLink"],{to:"#2\u72b6\u6001\u63d0\u5347","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09\u72b6\u6001\u63d0\u5347"),l.a.createElement("ul",null,l.a.createElement("li",null,"mobx \u91cc\u9762\u7684\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u5b58\u5728 React \u7ec4\u4ef6\u91cc\u9762\u7684\uff0c\u662f\u5728\u5916\u90e8\u7531\u4e00\u4e2a\u4e2a mobx \u7684\u6a21\u5757 ",l.a.createElement("code",null,"model")," \u6784\u6210"),l.a.createElement("li",null,"\u6bcf\u4e00\u4e2a ",l.a.createElement("code",null,"model")," \u53ef\u4ee5\u7406\u89e3\u6210\u4e00\u4e2a",l.a.createElement("code",null,"\u5bf9\u8c61"),"\uff0c\u72b6\u6001\u5b9e\u8d28\u5b58\u5728 model \u4e2d\uff0cmodel \u72b6\u6001",l.a.createElement("code",null,"\u901a\u8fc7 props \u6dfb\u52a0"),"\u5230\u7ec4\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u7528 mobx-react \u4e2d\u7684 ",l.a.createElement("code",null,"Provder")," \u548c ",l.a.createElement("code",null,"inject")," \u4fbf\u6377\u83b7\u53d6\u5b83\u4eec")),l.a.createElement("h3",{id:"3\u88c5\u9970\u5668\u6a21\u5f0f"},l.a.createElement(r["AnchorLink"],{to:"#3\u88c5\u9970\u5668\u6a21\u5f0f","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09\u88c5\u9970\u5668\u6a21\u5f0f"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u652f\u6301\u88c5\u9970\u5668\u6a21\u5f0f\u7684\u5199\u6cd5")),l.a.createElement(o["a"],{code:"class Root {\n  @observable name = 'alien'; /* \u5efa\u7acb\u89c2\u5bdf\u8005name\u5c5e\u6027 */\n  @action setName(name) {\n    this.name = name;\n  } /* \u6539\u53d8 name \u5c5e\u6027 */\n}",lang:"js"}),l.a.createElement("h3",{id:"4\u7cbe\u786e\u9897\u7c92\u5316\u6536\u96c6"},l.a.createElement(r["AnchorLink"],{to:"#4\u7cbe\u786e\u9897\u7c92\u5316\u6536\u96c6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4\uff09\u7cbe\u786e\u9897\u7c92\u5316\u6536\u96c6"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5bf9\u4e8e\u5c5e\u6027\u7684",l.a.createElement("code",null,"\u4f9d\u8d56\u6536\u96c6"),"\u662f",l.a.createElement("code",null,"\u7cbe\u786e"),"\u7684\uff0c",l.a.createElement("code",null,"\u9897\u7c92\u5316"),"\u7684")),l.a.createElement(o["a"],{code:"class Root {\n  @observable object = {\n    //C\u7ec4\u4ef6\u4f7f\u7528\n    name: 'alien', // A\u7ec4\u4ef6\u4f7f\u7528\n    mes: 'let us learn React!', // B\u7ec4\u4ef6\u4f7f\u7528\n  };\n  @action setName(name) {\n    this.object.name = name;\n  }\n  @action setMes(mes) {\n    this.object.mes = mes;\n  }\n  @action setObject(object) {\n    this.object = object;\n  }\n}",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,"\u6267\u884c ",l.a.createElement("code",null,"setName"),"\uff1a",l.a.createElement("code",null,"\u53ea\u6709"),"\u7ec4\u4ef6 ",l.a.createElement("code",null,"A")," \u4f1a",l.a.createElement("code",null,"\u66f4\u65b0")),l.a.createElement("li",null,"\u6267\u884c ",l.a.createElement("code",null,"setMes"),"\uff1a",l.a.createElement("code",null,"\u53ea\u6709"),"\u7ec4\u4ef6 ",l.a.createElement("code",null,"B")," \u4f1a",l.a.createElement("code",null,"\u66f4\u65b0")),l.a.createElement("li",null,"\u6267\u884c ",l.a.createElement("code",null,"setObject"),"\uff1aA\u3001B\u3001C ",l.a.createElement("code",null,"\u5168\u90e8\u6e32\u67d3"))),l.a.createElement("h3",{id:"5\u5f15\u7528\u7c7b\u578b\u5904\u7406"},l.a.createElement(r["AnchorLink"],{to:"#5\u5f15\u7528\u7c7b\u578b\u5904\u7406","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5\uff09\u5f15\u7528\u7c7b\u578b\u5904\u7406"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"\u5bf9\u4e8e\u5f15\u7528\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982 Object \uff0cArray \uff0cSet \uff0cMap \u7b49\uff0c\u9664\u4e86\u65b0\u5efa\u4e00\u4e2a observable \u4e4b\u5916\uff0c\u8fd8\u4f1a\u505a\u5982\u4e0b\u4e24\u70b9\u64cd\u4f5c\uff1a")),l.a.createElement("li",null,l.a.createElement("p",null,"1.",l.a.createElement("code",null,"Proxy"),"\uff1a\u4f1a\u628a\u539f\u59cb\u5bf9\u8c61\u7528 Proxy ",l.a.createElement("code",null,"\u4ee3\u7406"),"\uff0cProxy \u4f1a\u7cbe",l.a.createElement("code",null,"\u786e\u54cd\u5e94\u539f\u59cb\u5bf9\u8c61\u7684\u53d8\u5316"),"\uff0c\u6bd4\u5982",l.a.createElement("code",null,"\u589e\u52a0\u5c5e\u6027"),"\u2014\u2014\u7ed9\u5c5e\u6027\u7ed1\u5b9a ObserverValue \uff0c",l.a.createElement("code",null,"\u5220\u9664\u5c5e\u6027"),"\u2014\u2014\u7ed9\u5c5e\u6027\u89e3\u7ed1 ObserverValue \u7b49")),l.a.createElement("li",null,l.a.createElement("p",null,"2.",l.a.createElement("code",null,"ObservableAdministration"),"\uff1a \u5bf9\u4e8e\u5b50\u4ee3\u5c5e\u6027\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a ObservableAdministration\uff0c\u7528\u4e8e\u7ba1\u7406\u5b50\u4ee3\u5c5e\u6027\u7684 ObserverValue")),l.a.createElement("li",null,l.a.createElement("p",null,"\u5bf9\u4e8e\u5916\u5c42 Root \uff0c\u5728 constructor \u4f7f\u7528 makeObservable \uff0cmobx \u4f1a\u9ed8\u8ba4\u7ed9\u6700\u5916\u5c42\u7684 Root \u6dfb\u52a0 ObservableAdministration"))),l.a.createElement("h2",{id:"2mobx-\u5e38\u7528-api"},l.a.createElement(r["AnchorLink"],{to:"#2mobx-\u5e38\u7528-api","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2.mobx \u5e38\u7528 api"),l.a.createElement("h3",{id:"1makeobservable"},l.a.createElement(r["AnchorLink"],{to:"#1makeobservable","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09makeObservable"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u5728\u65b0\u7248\u672c mobx \u4e2d\uff0c\u60f3\u8981\u8ba9\u6574\u4e2a\u6a21\u5757\u53d8\u6210",l.a.createElement("code",null,"\u53ef\u54cd\u5e94\u5f0f"),"\u7684\uff0c\u90a3\u4e48\u9700\u8981\u5728 constructor \u8c03\u7528 makeObservable")),l.a.createElement(o["a"],{code:"constructor(){ makeObservable(this) }",lang:"js"}),l.a.createElement("h3",{id:"2observable"},l.a.createElement(r["AnchorLink"],{to:"#2observable","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09observable"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u7ed9",l.a.createElement("code",null,"\u5c5e\u6027\u503c\u52a0"),"\u4e00\u4e2a",l.a.createElement("code",null,"\u89c2\u5bdf\u8005\u5bf9\u8c61"),"\uff0c\u4f7f\u5176\u80fd",l.a.createElement("code",null,"\u53d8\u6210\u53ef\u89c2\u5bdf"),"\u7684\uff0c\u5f53\u5c5e\u6027\u503c\u6539\u53d8\u7684\u65f6\u5019\uff0c\u89c2\u5bdf\u8005\u4f1a\u901a\u77e5\u6bcf\u4e00\u4e2a\u4f9d\u8d56\u9879")),l.a.createElement(o["a"],{code:"@observable name = 'Bob'",lang:"js"}),l.a.createElement("h3",{id:"3action"},l.a.createElement(r["AnchorLink"],{to:"#3action","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09action"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u901a\u8fc7 action \u5305\u88f9\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u7528\u6765",l.a.createElement("code",null,"\u4fee\u6539")," mobx \u4e2d\u7684",l.a.createElement("code",null,"\u72b6\u6001"))),l.a.createElement(o["a"],{code:"@action setName(newName){ this.name = newName  }",lang:"js"}),l.a.createElement("h3",{id:"4computed"},l.a.createElement(r["AnchorLink"],{to:"#4computed","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4\uff09computed"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u6839\u636e\u73b0\u6709\u7684\u72b6\u6001\u6216\u5176\u5b83\u8ba1\u7b97\u503c",l.a.createElement("code",null,"\u884d\u751f\u51fa\u7684\u503c"))),l.a.createElement(o["a"],{code:"@observable price = 666  // \u53ef\u89c2\u5bdf\u5c5e\u6027\u2014\u2014\u4ef7\u683c\n@observable count = 1    // \u53ef\u89c2\u5bdf\u5c5e\u6027\u2014\u2014\u6570\u91cf\n@computed get total() {\n    return this.price * this.count\n}",lang:"js"}),l.a.createElement("h2",{id:"3mobx-react-\u5e38\u7528-api"},l.a.createElement(r["AnchorLink"],{to:"#3mobx-react-\u5e38\u7528-api","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3.mobx-react \u5e38\u7528 api"),l.a.createElement("ul",null,l.a.createElement("li",null,"mobx-react \u4e2d\u7684 api \uff0c\u7528\u4e8e\u628a ",l.a.createElement("code",null,"mobx")," \u4e2d\u7684",l.a.createElement("code",null,"\u72b6\u6001"),"\uff0c",l.a.createElement("code",null,"\u63d0\u4f9b\u7ed9\u7ec4\u4ef6"),"\uff0c\u5e76",l.a.createElement("code",null,"\u628a\u7ec4\u4ef6"),"\u4e5f",l.a.createElement("code",null,"\u53d8\u6210\u53ef\u89c2\u5bdf"),"\u7684 \u2014\u2014 mobx \u72b6\u6001\u6539\u53d8\uff0c\u7ec4\u4ef6\u89e6\u53d1\u66f4\u65b0")),l.a.createElement("h3",{id:"1provider"},l.a.createElement(r["AnchorLink"],{to:"#1provider","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09Provider"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u7528\u4e8e\u628a mobx \u7684\u5404\u4e2a\u6a21\u5757\uff0c\u7528 ",l.a.createElement("code",null,"Context")," \u4e0a\u4e0b\u6587\u5f62\u5f0f\uff0c",l.a.createElement("code",null,"\u4fdd\u5b58"),"\u8d77\u6765\uff0c\u4f9b\u7ed9\u7ec4\u4ef6",l.a.createElement("code",null,"\u4f7f\u7528"))),l.a.createElement(o["a"],{code:"<Provider Root={Root}> {/* ... */} </Provider>",lang:"js"}),l.a.createElement("h3",{id:"2inject"},l.a.createElement(r["AnchorLink"],{to:"#2inject","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09inject"),l.a.createElement("ul",null,l.a.createElement("li",null,"inject ",l.a.createElement("code",null,"\u9ad8\u9636\u7ec4\u4ef6"),"\u53ef\u4ee5\u628a Provider \u4e2d\u7684 mobx \u6a21\u5757\uff0c",l.a.createElement("code",null,"\u6df7\u5165"),"\u5230\u7ec4\u4ef6\u7684 ",l.a.createElement("code",null,"props")," \u4e2d\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u5728\u7ec4\u4ef6\u4e2d",l.a.createElement("code",null,"\u6d88\u8d39"),"\u72b6\u6001\uff0c\u6216\u8005\u8c03\u7528\u6539\u53d8\u72b6\u6001\u7684\u65b9\u6cd5")),l.a.createElement(o["a"],{code:"@inject('Root')\nclass Index extends React.Component {}",lang:"js"}),l.a.createElement("h3",{id:"3observer"},l.a.createElement(r["AnchorLink"],{to:"#3observer","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09observer"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"\u88ab")," observer \u9ad8\u9636\u7ec4\u4ef6",l.a.createElement("code",null,"\u5305\u88c5\u7684\u7ec4\u4ef6"),"\uff0c\u5982\u679c\u7ec4\u4ef6\u5185\u90e8\u5f15\u5165\u4e86 mobx \u53ef\u89c2\u5bdf\u5c5e\u6027\u503c\uff0c\u5f53\u503c\u6539\u53d8\u7684\u65f6\u5019\uff0c\u4f1a\u8ffd\u6eaf\u5230\u5f53\u524d\u7ec4\u4ef6\uff0c",l.a.createElement("code",null,"\u4fc3\u4f7f\u5f53\u524d\u7ec4\u4ef6\u66f4\u65b0"))),l.a.createElement(o["a"],{code:"@observer\nclass Index extends React.Component {}",lang:"js"}),l.a.createElement("h2",{id:"4\u72b6\u6001\u5171\u4eab"},l.a.createElement(r["AnchorLink"],{to:"#4\u72b6\u6001\u5171\u4eab","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4.\u72b6\u6001\u5171\u4eab"),l.a.createElement("h3",{id:"1root-\u6a21\u5757"},l.a.createElement(r["AnchorLink"],{to:"#1root-\u6a21\u5757","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09Root \u6a21\u5757"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u7528\u4e8e\u4fdd\u5b58\u5168\u5c40\u7684\u4e00\u4e9b\u6570\u636e")),l.a.createElement(o["a"],{code:"import { observable, action, makeObservable } from 'mobx';\nclass Root {\n  constructor() {\n    makeObservable(this);\n  }\n  @observable info = { name: 'xxx', mes: 'xxx' };\n  // @observable number = 1\n  @action setInfo(info) {\n    this.info = info;\n  }\n}\nexport default new Root();",lang:"js"}),l.a.createElement("h3",{id:"2\u6839\u7ec4\u4ef6\u6ce8\u5165\u72b6\u6001"},l.a.createElement(r["AnchorLink"],{to:"#2\u6839\u7ec4\u4ef6\u6ce8\u5165\u72b6\u6001","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09\u6839\u7ec4\u4ef6\u6ce8\u5165\u72b6\u6001"),l.a.createElement(o["a"],{code:"import Root from './mobx';\nexport default function Index() {\n  return (\n    <Provider Root={Root}>\n      <Child />\n    </Provider>\n  );\n}",lang:"js"}),l.a.createElement("h3",{id:"3\u4f7f\u7528\u72b6\u6001"},l.a.createElement(r["AnchorLink"],{to:"#3\u4f7f\u7528\u72b6\u6001","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09\u4f7f\u7528\u72b6\u6001"),l.a.createElement(o["a"],{code:"const getUserInfo = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve({ name: 'alien', mes: 'let us learn React!' });\n    }, 1000);\n  });\n};\n@inject('Root')\n@observer\nclass Child extends React.Component {\n  async componentDidMount() {\n    /*  \u6a21\u62df\u6570\u636e\u4ea4\u4e92 */\n    const res = await getUserInfo();\n    this.props.Root.setInfo(res);\n  }\n  render() {\n    const { info } = this.props.Root;\n    return (\n      <div className=\"box\">\n        <p> \u59d3\u540d\uff1a{info.name} </p>\n        <p> \u60f3\u5bf9\u5927\u5bb6\u8bf4\uff1a{info.mes} </p>\n      </div>\n    );\n  }\n}",lang:"js"}),l.a.createElement("h2",{id:"5\u7ec4\u4ef6\u901a\u4fe1"},l.a.createElement(r["AnchorLink"],{to:"#5\u7ec4\u4ef6\u901a\u4fe1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5.\u7ec4\u4ef6\u901a\u4fe1"),l.a.createElement("h3",{id:"1\u6ce8\u518c\u6a21\u5757"},l.a.createElement(r["AnchorLink"],{to:"#1\u6ce8\u518c\u6a21\u5757","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u6ce8\u518c\u6a21\u5757"),l.a.createElement(o["a"],{code:"class Communi {\n  constructor() {\n    makeObservable(this);\n  }\n  @observable mesA = '';\n  @observable mesB = '';\n  @action setMesA(mes) {\n    this.mesA = mes;\n  }\n  @action setMesB(mes) {\n    this.mesB = mes;\n  }\n}\nexport default new Communi();",lang:"js"}),l.a.createElement("h3",{id:"2ab-\u7ec4\u4ef6\u5b9e\u73b0\u901a\u4fe1"},l.a.createElement(r["AnchorLink"],{to:"#2ab-\u7ec4\u4ef6\u5b9e\u73b0\u901a\u4fe1","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09A\uff0cB \u7ec4\u4ef6\u5b9e\u73b0\u901a\u4fe1"),l.a.createElement(o["a"],{code:"@inject('Communi')\n@observer\nclass ComponentA extends React.Component {\n  /* \u7ec4\u4ef6A */\n  state = { CompAsay: '' };\n  render() {\n    const { CompAsay } = this.state;\n    const { mesB } = this.props.Communi;\n    return (\n      <div className=\"box\">\n        <p>\u6211\u662f\u7ec4\u4ef6A</p>\n        <div> B\u7ec4\u4ef6\u5bf9\u6211\u8bf4\uff1a{mesB} </div>\n        \u6211\u5bf9B\u7ec4\u4ef6\u8bf4\uff1a{' '}\n        <input\n          onChange={(e) => this.setState({ CompAsay: e.target.value })}\n          placeholder=\"CompAsay\"\n        />\n        <button onClick={() => this.props.Communi.setMesA(CompAsay)}>\u786e\u5b9a</button>\n      </div>\n    );\n  }\n}\n@inject('Communi')\n@observer\nclass ComponentB extends React.Component {\n  /* \u7ec4\u4ef6B */\n  state = { compBsay: '' };\n  render() {\n    const { compBsay } = this.state;\n    const { mesA } = this.props.Communi;\n    return (\n      <div className=\"box pt50\">\n        <p>\u6211\u662f\u7ec4\u4ef6B</p>\n        <div> A\u7ec4\u4ef6\u5bf9\u6211\u8bf4\uff1a{mesA} </div>\n        \u6211\u5bf9A\u7ec4\u4ef6\u8bf4\uff1a\n        <input\n          onChange={(e) => this.setState({ compBsay: e.target.value })}\n          placeholder=\"CompAsay\"\n        />\n        <button onClick={() => this.props.Communi.setMesB(compBsay)}>\n          \u786e\u5b9a\n        </button>\n      </div>\n    );\n  }\n}",lang:"js"}),l.a.createElement("h2",{id:"6mobx-\u548c-mobx-react-\u6574\u4e2a\u6d41\u7a0b"},l.a.createElement(r["AnchorLink"],{to:"#6mobx-\u548c-mobx-react-\u6574\u4e2a\u6d41\u7a0b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"6.mobx \u548c mobx-react \u6574\u4e2a\u6d41\u7a0b"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"\u521d\u59cb\u5316"),"\uff1a\u9996\u5148\u5c31\u662f mobx \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u662f",l.a.createElement("code",null,"\u5982\u4f55\u5904\u7406")," observable \u53ef\u89c2\u5bdf\u5c5e\u6027\u7684"),l.a.createElement("li",null,l.a.createElement("code",null,"\u4f9d\u8d56\u6536\u96c6"),"\uff1a\u7b2c\u4e8c\u70b9\u5c31\u662f\u901a\u8fc7 mobx-react \u4e2d\u7684 observer \uff0c",l.a.createElement("code",null,"\u5982\u4f55\u6536\u96c6"),"\u4f9d\u8d56\u9879\uff0c\u4e0e observable \u5efa\u7acb\u8d77\u5173\u7cfb\u7684"),l.a.createElement("li",null,l.a.createElement("code",null,"\u6d3e\u53d1\u66f4\u65b0"),"\uff1a\u6700\u540e\u5c31\u662f\u5f53\u6539\u53d8\u53ef\u89c2\u5bdf\u5c5e\u6027\u7684\u503c\u7684\u65f6\u5019\uff0c",l.a.createElement("code",null,"\u5982\u4f55\u66f4\u65b0"),"\u5bf9\u5e94\u7ec4\u4ef6\u7684")),l.a.createElement("h2",{id:"7\u6a21\u5757\u521d\u59cb\u5316"},l.a.createElement(r["AnchorLink"],{to:"#7\u6a21\u5757\u521d\u59cb\u5316","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"7.\u6a21\u5757\u521d\u59cb\u5316"),l.a.createElement("h3",{id:"1\u7ed1\u5b9a\u72b6\u6001observable"},l.a.createElement(r["AnchorLink"],{to:"#1\u7ed1\u5b9a\u72b6\u6001observable","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u7ed1\u5b9a\u72b6\u6001\u2014\u2014observable"),l.a.createElement(o["a"],{code:"function createObservable(target, name, descriptor) {\n  // \u5bf9\u4e8e\u5982\u4e0aDEMO1\uff0ctarget\u2014\u2014Root\u7c7b\uff0cname\u2014\u2014\u5c5e\u6027\u540d\u79f0 authorInfo \u6216\u8005 name \uff0cdescriptor\u2014\u2014\u5c5e\u6027\u63cf\u8ff0\uff0c\u679a\u4e3e\u6027\uff0c\u53ef\u8bfb\u6027\u7b49\n  if (isStringish(name)) {\n    /* \u88c5\u9970\u5668\u6a21\u5f0f\u4e0b */\n    target[Symbol('mobx-stored-annotations')][name] = {\n      /* \u5411\u7c7b\u7684mobx-stored-annotations\u5c5e\u6027\u7684name\u5c5e\u6027\u4e0a\uff0c\u7ed1\u5b9a annotationType_ \uff0c extend_ \u7b49\u65b9\u6cd5\u3002 */\n      annotationType_: 'observable', //\u8fd9\u4e2a\u6807\u7b7e\u8bc1\u660e\u662f observable\uff0c\u9664\u4e86observable\uff0c\u8fd8\u6709 action\uff0c computed \u7b49\u3002\n      options_: null,\n      make_, // \u8fd9\u4e2a\u65b9\u6cd5\u5728\u7c7b\u7ec4\u4ef6 makeObservable \u4f1a\u88ab\u6fc0\u6d3b\n      extend_, // \u8fd9\u4e2a\u65b9\u6cd5\u5728\u7c7b\u7ec4\u4ef6 makeObservable \u4f1a\u88ab\u6fc0\u6d3b\n    };\n  }\n}",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,"\u88ab observable \u88c5\u9970\u5668\u5305\u88c5\u7684\u5c5e\u6027\uff0c",l.a.createElement("code",null,"\u672c\u8d28"),"\u4e0a\u5c31\u662f",l.a.createElement("code",null,"\u8c03\u7528 createObservable")," \u65b9\u6cd5"),l.a.createElement("li",null,"\u901a\u8fc7 createObservable \u5c06\u7c7b\u4e0a\u7ed1\u5b9a\u5f53\u524d observable \u5bf9\u5e94\u7684\u914d\u7f6e\u9879\uff0c\u7ed9 observable \u7ed1\u5b9a\u7684\u5c5e\u6027\u6dfb\u52a0\u4e00\u4e9b",l.a.createElement("code",null,"\u989d\u5916\u7684\u72b6\u6001"),"\uff0c\u8fd9\u4e9b\u72b6\u6001\u5c06\u5728",l.a.createElement("code",null,"\u7c7b\u5b9e\u4f8b\u5316"),"\u7684\u65f6\u5019 ",l.a.createElement("code",null,"makeObservable")," \u4e2d\u88ab",l.a.createElement("code",null,"\u6fc0\u6d3b"))),l.a.createElement("h3",{id:"2\u6fc0\u6d3b\u72b6\u6001makeobservable"},l.a.createElement(r["AnchorLink"],{to:"#2\u6fc0\u6d3b\u72b6\u6001makeobservable","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09\u6fc0\u6d3b\u72b6\u6001\u2014\u2014makeObservable"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u521b\u5efa\u4e00\u4e2a\u7ba1\u7406\u8005 ObservableAdministration \uff0c\u7ba1\u7406\u8005\u5c31\u662f\u4e3a\u4e86\u7ba1\u7406\u5b50\u4ee3\u5c5e\u6027\u7684 ObservableValue \u3002\u5e76\u548c\u6a21\u5757\u5b9e\u4f8b\u5efa\u7acb\u8d77\u5173\u7cfb"),l.a.createElement("li",null,"\u7136\u540e\u4f1a\u904d\u5386\u89c2\u5bdf\u8005\u72b6\u6001\u4e0b\u7684\u6bcf\u4e00\u4e2a\u5c5e\u6027\uff0c\u5c06\u6bcf\u4e2a\u5c5e\u6027\u901a\u8fc7 ",l.a.createElement("code",null,"adm.make_"),"\u5904\u7406")),l.a.createElement(o["a"],{code:"function make_(adm, key, descriptor) {\n  /*  \u5f53\u8c03\u7528 observable \u914d\u7f6e\u9879\u7684 make_ \uff0c\u672c\u8d28\u4e0a\u8c03\u7528 adm.defineObservableProperty_*/\n  return this.extend_(adm, key, descriptor);\n}\nfunction extend_(adm, key, descriptor) {\n  return adm.defineObservableProperty_(key, descriptor, options);\n}\nfunction makeObservable(target) {\n  // target \u6a21\u5757\u5b9e\u4f8b\u2014\u2014this\n  const adm = new ObservableObjectAdministration(\n    target,\n  ); /* \u521b\u5efa\u4e00\u4e2a\u7ba1\u7406\u8005\u2014\u2014\u8fd9\u4e2a\u7ba1\u7406\u8005\u662f\u6700\u4e0a\u5c42\u7684\u7ba1\u7406\u8005\uff0c\u7ba1\u7406\u6a21\u5757\u4e0b\u7684observable\u5c5e\u6027 */\n  target[Symbol('mobx administration')] =\n    adm; /* \u5c06\u7ba1\u7406\u8005 adm \u548c class \u5b9e\u4f8b\u5efa\u7acb\u8d77\u5173\u8054 */\n  startBatch();\n  try {\n    let annotations =\n      target[Symbol('mobx-stored-annotations')]; /* \u4e0a\u9762\u7b2c\u4e00\u6b65\u8bf4\u5230\uff0c\u83b7\u53d6\u72b6\u6001 */\n    /* \u5f97\u5230\u6bcf\u4e2a\u72b6\u6001\u540d\u79f0 */\n    Reflect.ownKeys(annotations).forEach((key) =>\n      adm.make_(key, annotations[key]),\n    ); /* \u5bf9\u6bcf\u4e2a\u5c5e\u6027\u8c03\u7528 */\n  } finally {\n    endBatch();\n  }\n}",lang:"js"}),l.a.createElement("h3",{id:"3\u89c2\u5bdf\u8005\u5c5e\u6027\u7ba1\u7406\u8005observableadministration"},l.a.createElement(r["AnchorLink"],{to:"#3\u89c2\u5bdf\u8005\u5c5e\u6027\u7ba1\u7406\u8005observableadministration","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09\u89c2\u5bdf\u8005\u5c5e\u6027\u7ba1\u7406\u8005\u2014\u2014ObservableAdministration"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u9996\u5148\u4f1a\u901a\u8fc7 ",l.a.createElement("code",null,"Object.defineProperty")," \uff0c",l.a.createElement("code",null,"\u62e6\u622a"),"\u5bf9\u8c61\u7684",l.a.createElement("code",null,"\u5c5e\u6027"),"\uff0c\u6dfb\u52a0 get\uff0cset \uff0c\u6bd4\u5982\u7ec4\u4ef6\u4e2d\u5f15\u7528\u5bf9\u8c61\u4e0a\u7684\u5c5e\u6027\uff0c\u8c03\u7528 get \u2014\u2014\u672c\u8d28\u4e0a\u8c03\u7528 ",l.a.createElement("code",null,"getObservablePropValue_")," \uff0c\u5728 observableValues \u8c03\u7528\u7684\u662f get \u65b9\u6cd5\uff1b\u5f53\u4fee\u6539\u5bf9\u8c61\u4e0a\u7684\u5c5e\u6027\uff0c\u8c03\u7528 set \u2014\u2014\u672c\u8d28\u4e0a\u8c03\u7528 ",l.a.createElement("code",null,"setObservablePropValue_")," \uff0c",l.a.createElement("code",null,"setObservablePropValue_")," \u8c03\u7528\u7684\u662f ObservableValues \u4e0a\u7684 ",l.a.createElement("code",null,"setNewValue_")," \u65b9\u6cd5"),l.a.createElement("li",null,"\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5c5e\u6027\u4f1a\u589e\u52a0\u4e00\u4e2a\u89c2\u5bdf\u8005 ObservableValue \uff0c\u7136\u540e\u628a\u5f53\u524d ObservableValue \u653e\u5165\u7ba1\u7406\u8005 ObservableAdministration \u7684 ",l.a.createElement("code",null,"values_")," \u5c5e\u6027\u4e0a")),l.a.createElement(o["a"],{code:"class ObservableObjectAdministration {\n  constructor(target_, values_) {\n    this.target_ = target_;\n    this.values_ = new Map(); //\u5b58\u653e\u6bcf\u4e00\u4e2a\u5c5e\u6027\u7684ObserverValue\u3002\n  }\n  /* \u8c03\u7528 ObserverValue\u7684 get \u2014\u2014 \u6536\u96c6\u4f9d\u8d56  */\n  getObservablePropValue_(key) {\n    return this.values_.get(key)!.get();\n  }\n  /* \u8c03\u7528 ObserverValue\u7684 setNewValue_   */\n  setObservablePropValue_(key, newValue) {\n    const observable = this.values_.get(key);\n    observable.setNewValue_(newValue); /* \u8bbe\u7f6e\u65b0\u503c */\n  }\n  make_(key, annotation) {\n    // annotation \u4e3a\u6bcf\u4e2aobservable\u5bf9\u5e94\u7684\u914d\u7f6e\u9879\u7684\u5185\u5bb9\uff0c{ make_,extends }\n    const outcome = annotation.make_(this, key, descriptor, source);\n  }\n  /* \u8fd9\u4e2a\u51fd\u6570\u5f88\u91cd\u8981\uff0c\u7528\u4e8e\u52ab\u6301\u5bf9\u8c61\u4e0a\u7684get,set */\n  defineObservableProperty_(key, value) {\n    try {\n      startBatch();\n      const descriptor = {\n        get() {\n          // \u5f53\u6211\u4eec\u5f15\u7528\u5bf9\u8c61\u4e0b\u7684\u5c5e\u6027\uff0c\u5b9e\u9645\u4e0a\u89e6\u53d1\u7684\u662f getObservablePropValue_\n          this.getObservablePropValue_(key);\n        },\n        set(value) {\n          // \u5f53\u6211\u4eec\u6539\u53d8\u5bf9\u8c61\u4e0b\u7684\u5c5e\u6027\uff0c\u5b9e\u9645\u4e0a\u89e6\u53d1\u7684\u662f setObservablePropValue_\n          this.setObservablePropValue_(key, value);\n        },\n      };\n      Object.defineProperty(this.target_, key, descriptor);\n      const observable = new ObservableValue(value); // \u521b\u5efa\u4e00\u4e2a ObservableValue\n      this.values_.set(key, observable); // \u8bbe\u7f6eobservable\u5230value\u4e2d\n    } finally {\n      endBatch();\n    }\n  }\n}",lang:"ts"}),l.a.createElement("h2",{id:"8\u4f9d\u8d56\u6536\u96c6"},l.a.createElement(r["AnchorLink"],{to:"#8\u4f9d\u8d56\u6536\u96c6","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"8.\u4f9d\u8d56\u6536\u96c6"),l.a.createElement("h3",{id:"1\u89c2\u5bdf\u8005observablevalue"},l.a.createElement(r["AnchorLink"],{to:"#1\u89c2\u5bdf\u8005observablevalue","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u89c2\u5bdf\u8005\u2014\u2014ObservableValue"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u89c2\u5bdf\u8005\u5c5e\u6027\u7ba1\u7406\u8005\u6700\u7ec8\u8c03\u7528\u7684\u4e24\u4e2a\u65b9\u6cd5\u2014\u2014 ",l.a.createElement("code",null,"get")," \u548c ",l.a.createElement("code",null,"setNewValue_ "))),l.a.createElement(o["a"],{code:"class Atom {\n  observers_ = new Set(); /* \u5b58\u653e\u6bcf\u4e2a\u7ec4\u4ef6\u7684 */\n  /* value\u6539\u53d8\uff0c\u901a\u77e5\u66f4\u65b0 */\n  reportChanged() {\n    startBatch();\n    propagateChanged(this);\n    endBatch();\n  }\n  /* \u6536\u96c6\u4f9d\u8d56 */\n  reportObserved() {\n    return reportObserved(this);\n  }\n}\n\nclass ObservableValue extends Atom {\n  get() {\n    //adm.getObservablePropValue_ \u88ab\u8c03\u7528\n    this.reportObserved(); // \u8c03\u7528Atom\u4e2d reportObserved\n    return this.dehanceValue(this.value_);\n  }\n  setNewValue_(newValue) {\n    // adm.setObservablePropValue_\n    const oldValue = this.value_;\n    this.value_ = newValue;\n    this.reportChanged(); // \u8c03\u7528Atom\u4e2dreportChanged\n  }\n}",lang:"js"}),l.a.createElement("h3",{id:"2\u6ce8\u5165\u6a21\u5757provider"},l.a.createElement(r["AnchorLink"],{to:"#2\u6ce8\u5165\u6a21\u5757provider","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09\u6ce8\u5165\u6a21\u5757\u2014\u2014Provider"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u521b\u5efa\u4e00\u4e2a\u4e0a\u4e0b\u6587 ",l.a.createElement("code",null,"context")," \uff0c\u5e76\u901a\u8fc7 ",l.a.createElement("code",null,"context.Provider")," \u4f20\u9012\u4e0a\u4e0b\u6587")),l.a.createElement(o["a"],{code:"const MobXProviderContext = React.createContext({});\nexport function Provider(props) {\n  /* ... */\n  return (\n    <MobXProviderContext.Provider value={value}>\n      {children}\n    </MobXProviderContext.Provider>\n  );\n}",lang:"js"}),l.a.createElement("h3",{id:"3\u6ce8\u5165\u6a21\u5757inject"},l.a.createElement(r["AnchorLink"],{to:"#3\u6ce8\u5165\u6a21\u5757inject","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09\u6ce8\u5165\u6a21\u5757\u2014\u2014inject"),l.a.createElement("ul",null,l.a.createElement("li",null,"inject \u4f5c\u7528\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5c06 mobx \u7684\u72b6\u6001\uff0c\u4ece ",l.a.createElement("code",null,"context")," \u4e2d",l.a.createElement("code",null,"\u6df7\u5165 props")," \u4e2d")),l.a.createElement(o["a"],{code:"function inject(...storeNames) {\n  const Injector = React.forwardRef((props, ref) => {\n    let newProps = { ...props };\n    const context = React.useContext(MobXProviderContext);\n    storeNames.forEach(function (storeName) {\n      //storeNames - [ 'Root' ]\n      if (storeName in newProps) return;\n      if (!(storeName in context)) {\n        /* \u5c06mobx\u72b6\u6001\u4ececontext\u4e2d\u6df7\u5165\u5230props\u4e2d\u3002 */\n        newProps[storeName] = context[storeName];\n      }\n    });\n    return React.createElement(component, newProps);\n  });\n  return Injector;\n}",lang:"js"}),l.a.createElement("h3",{id:"4\u53ef\u89c2\u5bdf\u7ec4\u4ef6-observer"},l.a.createElement(r["AnchorLink"],{to:"#4\u53ef\u89c2\u5bdf\u7ec4\u4ef6-observer","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4\uff09\u53ef\u89c2\u5bdf\u7ec4\u4ef6\u2014\u2014 observer"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"mobx-react \u4e2d ",l.a.createElement("code",null,"observer")," HOC \u7684\u4f5c\u7528\u2014\u2014",l.a.createElement("code",null,"\u6e32\u67d3 render \u7684\u52ab\u6301"))),l.a.createElement("li",null,l.a.createElement("p",null,"\u901a\u8fc7",l.a.createElement("code",null,"\u52ab\u6301 render \u51fd\u6570\u6267\u884c"),"\uff0c\u6536\u96c6\u91cc\u9762\u7684\u4f9d\u8d56\u3002")),l.a.createElement("li",null,l.a.createElement("p",null,"\u88ab observe \u7684\u7ec4\u4ef6\uff0c\u88ab\u8d4b\u4e88\u4e00\u9879\u529f\u80fd\uff0c\u5c31\u662f\u53ef\u89c2\u5bdf\u7684")),l.a.createElement("li",null,l.a.createElement("p",null,"\u5f53\u91cc\u9762\u5f15\u7528\u4e86 mobx \u4e2d\u7684 ObservableValue \uff0c\u5f53 ObservableValue \u6539\u53d8\uff0c\u7ec4\u4ef6\u4f1a\u66f4\u65b0"))),l.a.createElement(o["a"],{code:"function observer(componentClass) {\n  /* componentClass \u662f\u7c7b\u7ec4\u4ef6\u7684\u60c5\u51b5 (\u51fd\u6570\u7ec4\u4ef6\u6211\u4eec\u6682\u4e14\u5ffd\u7565) */\n  return function makeClassComponentObserver() {\n    const target = componentClass.prototype;\n    const baseRender = target.render; /* \u8fd9\u4e2a\u662f\u539f\u6765\u7ec4\u4ef6\u7684render */\n    /* \u52ab\u6301render\u51fd\u6570 */\n    target.render = function () {\n      return makeComponentReactive.call(this, baseRender);\n    };\n  };\n}\n\nfunction makeComponentReactive() {\n  const baseRender = render.bind(this); // baseRender\u4e3a\u771f\u6b63\u7684render\u65b9\u6cd5\n  /* \u521b\u5efa\u4e00\u4e2a\u53cd\u5e94\u5668\uff0c\u7ed1\u5b9a\u7c7b\u7ec4\u4ef6\u7684\u66f4\u65b0\u51fd\u6570 \u2014\u2014 forceUpdate  */\n  const reaction = new Reaction(`${initialName}.render()`, () => {\n    Component.prototype.forceUpdate.call(\n      this,\n    ); /* forceUpdate \u4e3a\u7c7b\u7ec4\u4ef6\u66f4\u65b0\u51fd\u6570 */\n  });\n  reaction['reactComponent'] = this; /* Reaction \u548c \u7ec4\u4ef6\u5b9e\u4f8b\u5efa\u7acb\u8d77\u5173\u8054 */\n  reactiveRender['$mobx'] = reaction;\n  this.render = reactiveRender;\n  function reactiveRender() {\n    /* \u6539\u9020\u7684\u54cd\u5e94\u5f0frender\u65b9\u6cd5 */\n    reaction.track(() => {\n      // track\u4e2d\u8fdb\u884c\u771f\u6b63\u7684\u4f9d\u8d56\u6536\u96c6\n      try {\n        rendering = baseRender(); /* \u6267\u884c\u66f4\u65b0\u51fd\u6570 */\n      } catch {}\n    });\n    return rendering;\n  }\n  return reactiveRender.call(this);\n}",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"makeComponentReactive \u901a\u8fc7",l.a.createElement("code",null,"\u6539\u9020 render \u51fd\u6570"),"\uff0c\u6765\u5b9e\u73b0\u4f9d\u8d56\u7684\u6536\u96c6:"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"\u6bcf\u4e00\u4e2a\u7ec4\u4ef6\u4f1a\u521b\u5efa\u4e00\u4e2a ",l.a.createElement("code",null,"Reaction"),"\uff0cReaction \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5185\u90e8\u5c01\u88c5\u4e86\u66f4\u65b0\u7ec4\u4ef6\u7684\u65b9\u6cd5\u3002\u90a3\u4e48\u5982\u679c\u89e6\u53d1\u53ef\u89c2\u5bdf\u5c5e\u6027\u7684 ",l.a.createElement("code",null,"set")," \uff0c\u90a3\u4e48\u6700\u540e\u89e6\u53d1\u66f4\u65b0\u7684\u5c31\u662f\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u5bf9\u4e8e\u7c7b\u7ec4\u4ef6\u672c\u8d28\u4e0a\u5c31\u662f\u7684 ",l.a.createElement("code",null,"forceUpdate")," \u65b9\u6cd5")),l.a.createElement("li",null,l.a.createElement("p",null,"\u5bf9 render \u51fd\u6570\u8fdb\u884c\u6539\u9020\uff0c\u6539\u9020\u6210 ",l.a.createElement("code",null,"reactiveRender")," \uff0c\u5728 reactiveRender \u4e2d\uff0creaction.",l.a.createElement("code",null,"track")," \u662f\u771f\u6b63\u7684\u8fdb\u884c\u4f9d\u8d56\u7684\u6536\u96c6\uff0ctrack \u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u6267\u884c\u771f\u6b63\u7684 render \u65b9\u6cd5\uff0c\u5f97\u5230 element \u5bf9\u8c61 rendering"))))),l.a.createElement("h3",{id:"5\u53cd\u5e94\u5668reaction"},l.a.createElement(r["AnchorLink"],{to:"#5\u53cd\u5e94\u5668reaction","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5\uff09\u53cd\u5e94\u5668\u2014\u2014Reaction"),l.a.createElement(o["a"],{code:"class Reaction {\n  constructor(name_, onInvalidate_) {\n    this.name_ = name_;\n    this.onInvalidate_ =\n      onInvalidate_; /* onInvalidate_ \u91cc\u9762\u6709\u7ec4\u4ef6\u7684forceUpdate\u51fd\u6570\uff0c\u7528\u4e8e\u66f4\u65b0\u7ec4\u4ef6 */\n  }\n  onBecomeStale_() {\n    this.schedule_(); /* \u89e6\u53d1\u8c03\u5ea6\u66f4\u65b0 */\n  }\n  /* \u5f00\u542f\u8c03\u5ea6\u66f4\u65b0 */\n  schedule_() {\n    if (!this.isScheduled_) {\n      this.isScheduled_ = true;\n      globalState.pendingReactions.push(this);\n      runReactions();\n    }\n  }\n  /* \u66f4\u65b0 */\n  runReaction_() {\n    startBatch();\n    this.isScheduled_ = false;\n    const prev = globalState.trackingContext;\n    globalState.trackingContext = this;\n    this.onInvalidate_(); /* \u66f4\u65b0\u7ec4\u4ef6  */\n    globalState.trackingContext = prev;\n    endBatch();\n  }\n  /* \u6536\u96c6\u4f9d\u8d56 */\n  track(fn) {\n    startBatch();\n    /* \u7b2c\u4e00\u9636\u6bb5 */\n    const prevTracking = globalState.trackingDerivation;\n    globalState.trackingDerivation = this;\n    /* \u7b2c\u4e8c\u9636\u6bb5 */\n    const result = fn.call(context);\n    globalState.trackingDerivation = prevTracking;\n    /* \u7b2c\u4e09\u9636\u6bb5 */\n    bindDependencies(this);\n  }\n}",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"\u7b2c\u4e00\u9636\u6bb5\uff1a \u9996\u5148\u5728\u6267\u884c track \u7684\u65f6\u5019\uff0c\u4f1a\u628a\u5168\u5c40\u53d8\u91cf\u7684 trackingDerivation\uff0c\u6307\u5411\u5f53\u524d\u7684 trackingDerivation \u3002\u8fd9\u6837\u5728\u6536\u96c6\u4f9d\u8d56\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u76f4\u63a5\u6536\u96c6\u5f53\u524d\u7684 trackingDerivation \uff0c\u4e5f\u5c31\u662f\u4e3a\u4ec0\u4e48 ObservableValue \u80fd\u7cbe\u786e\u6536\u96c6\u6bcf\u4e00\u4e2a Reaction")),l.a.createElement("li",null,l.a.createElement("p",null,"\u7b2c\u4e8c\u9636\u6bb5\uff1a\u9996\u5148\u5f53\u88ab observer \u5305\u88c5\u7684\u7ec4\u4ef6\uff0c\u53ea\u8981\u6267\u884c render \u51fd\u6570\uff0c\u5c31\u4f1a\u6267\u884c track \u65b9\u6cd5\uff0cfn.call(context)\uff0c\u771f\u6b63\u7684 r ender \u51fd\u6570\u4f1a\u5728\u91cc\u9762\u6267\u884c"))),l.a.createElement("h2",{id:"9\u6d3e\u53d1\u66f4\u65b0"},l.a.createElement(r["AnchorLink"],{to:"#9\u6d3e\u53d1\u66f4\u65b0","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"9.\u6d3e\u53d1\u66f4\u65b0"),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("p",null,"\u7b2c\u4e00\u6b65\uff1a \u9996\u5148\u5bf9\u4e8e\u89c2\u5bdf\u8005\u5c5e\u6027\u7ba1\u7406\u8005 ObservableAdministration \u4f1a\u89e6\u53d1 setObservablePropValue* \uff0c\u7136\u540e\u627e\u5230\u5bf9\u5e94\u7684 ObservableValue \u89e6\u53d1 ",l.a.createElement("code",null,"setNewValue_")," \u65b9\u6cd5\u3002")),l.a.createElement("li",null,l.a.createElement("p",null,"\u7b2c\u4e8c\u6b65\uff1a ",l.a.createElement("code",null,"setNewValue_")," \u672c\u8d28\u4e0a\u4f1a\u89e6\u53d1 Atom \u4e2d\u7684 reportChanged \uff0c\u7136\u540e\u8c03\u7528 ",l.a.createElement("code",null,"propagateChanged")))),l.a.createElement(o["a"],{code:"function propagateChanged(observable) {\n  observable.observers_.forEach((Reaction) => {\n    Reaction.onBecomeStale_();\n  });\n}",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,"\u7b2c\u4e09\u6b65\uff1a Reaction \u7684 onBecomeStale* \u89e6\u53d1\uff0c\u4f1a\u8ba9 Reaction \u7684 schedule* \u6267\u884c",l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("code",null,"schedule_")," \u4f1a\u5f00\u542f\u66f4\u65b0\u8c03\u5ea6"),l.a.createElement("li",null,"\u66f4\u65b0\u8c03\u5ea6\u5c31\u662f ",l.a.createElement("code",null,"schedule_")," \u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u6267\u884c\u7ec4\u4ef6\u66f4\u65b0\uff0c\u800c\u662f\u628a\u5f53\u524d\u7684 Reaction \u653e\u5165 globalState.pendingReactions\uff08\u5f85\u66f4\u65b0 Reaction \u961f\u5217\uff09\u4e2d\uff0c\u7136\u540e\u4f1a\u6267\u884c ",l.a.createElement("code",null,"runReactions")," \u5916\u90e8\u65b9\u6cd5")))),l.a.createElement(o["a"],{code:"function runReactions() {\n  if (globalState.inBatch > 0 || globalState.isRunningReactions) return;\n  globalState.isRunningReactions = true;\n  const allReactions = globalState.pendingReactions;\n  /* \u8fd9\u91cc\u7684\u4ee3\u7801\u662f\u7ecf\u8fc7\u4fee\u6539\u8fc7\u540e\u7684\uff0c\u6e90\u7801\u4e2d\u8981\u6bd4 */\n  allReactions.forEach((Reaction) => {\n    /* \u6267\u884c\u6bcf\u4e00\u4e2a\u7ec4\u4ef6\u7684\u66f4\u65b0\u51fd\u6570 */\n    Reaction.runReaction_();\n  });\n  globalState.pendingReactions = [];\n  globalState.isRunningReactions = false;\n}",lang:"js"}),l.a.createElement("ul",null,l.a.createElement("li",null,"\u7b2c\u56db\u6b65\uff1a \u6267\u884c\u6bcf\u4e00\u4e2a Reaction \uff0c\u5f53\u4e00\u4e2a ObservableValue \u7684\u5c5e\u6027\u503c\u6539\u53d8\uff0c\u53ef\u4ee5\u6536\u96c6\u4e86\u591a\u4e2a\u7ec4\u4ef6\u7684\u4f9d\u8d56\uff0c\u6240\u4ee5 mobx \u7528\u8fd9\u4e2a\u8c03\u5ea6\u673a\u5236\uff0c\u5148\u628a\u6bcf\u4e00\u4e2a Reaction \u653e\u5165 pendingReactions \u4e2d\uff0c\u7136\u540e\u96c6\u4e2d\u5904\u7406\u8fd9\u4e9b Reaction \uff0c Reaction \u4f1a\u89e6\u53d1 ",l.a.createElement("code",null,"runReaction_()")," \u65b9\u6cd5\uff0c\u4f1a\u89e6\u53d1 ",l.a.createElement("code",null,"onInvalidate_")," \u2014\u2014\u7c7b\u7ec4\u4ef6\u7684 forceupdate \u65b9\u6cd5\u5b8c\u6210\u7ec4\u4ef6\u66f4\u65b0")),l.a.createElement("h2",{id:"10mobx-\u4e0e-redux-\u533a\u522b"},l.a.createElement(r["AnchorLink"],{to:"#10mobx-\u4e0e-redux-\u533a\u522b","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"10.Mobx \u4e0e Redux \u533a\u522b"),l.a.createElement("ul",null,l.a.createElement("li",null,"1.\u5728 Mobx \u5728",l.a.createElement("code",null,"\u4e0a\u624b\u7a0b\u5ea6"),"\u4e0a\uff0c\u8981\u4f18\u4e8e Redux \uff0c\u6bd4\u5982 Redux \u60f3\u4f7f\u7528\u5f02\u6b65\uff0c\u9700\u8981\u914d\u5408\u4e2d\u95f4\u4ef7\uff0c\u6d41\u7a0b\u6bd4\u8f83\u590d\u6742"),l.a.createElement("li",null,"2.",l.a.createElement("code",null,"Redux")," \u5bf9\u4e8e",l.a.createElement("code",null,"\u6570\u636e\u6d41\u5411"),"\u66f4\u89c4\u8303\u5316\uff0c",l.a.createElement("code",null,"Mobx")," \u4e2d\u6570\u636e\u66f4\u52a0\u591a\u6837\u5316\uff0c",l.a.createElement("code",null,"\u5141\u8bb8\u6570\u636e\u5197\u4f59")),l.a.createElement("li",null,"3.Redux \u6574\u4f53\u6570\u636e\u6d41\u5411\u7b80\u5355\uff0cMobx \u4f9d\u8d56\u4e8e ",l.a.createElement("code",null,"Proxy"),"\uff0c ",l.a.createElement("code",null,"Object.defineProperty")," \u7b49\uff0c",l.a.createElement("code",null,"\u52ab\u6301"),"\u5c5e\u6027 get \uff0cset \uff0c\u6570\u636e\u53d8\u5316\u591a\u6837\u6027"),l.a.createElement("li",null,"4.",l.a.createElement("code",null,"Redux")," \u53ef",l.a.createElement("code",null,"\u62d3\u5c55\u6027"),"\u6bd4\u8f83",l.a.createElement("code",null,"\u5f3a"),"\uff0c\u53ef\u4ee5\u901a\u8fc7",l.a.createElement("code",null,"\u4e2d\u95f4\u4ef6"),"\u81ea\u5b9a\u4e49\u589e\u5f3a dispatch"),l.a.createElement("li",null,"5.\u5728 ",l.a.createElement("code",null,"Redux")," \u4e2d\uff0c\u57fa\u672c",l.a.createElement("code",null,"\u6709\u4e00\u4e2a store")," \uff0c\u7edf\u4e00\u7ba1\u7406 store \u4e0b\u7684\u72b6\u6001\uff0c\u5728 ",l.a.createElement("code",null,"mobx")," \u4e2d\u53ef\u4ee5\u6709",l.a.createElement("code",null,"\u591a\u4e2a\u6a21\u5757"),"\uff0c\u53ef\u4ee5\u7406\u89e3\u6bcf\u4e00\u4e2a\u6a21\u5757\u90fd\u662f\u4e00\u4e2a store \uff0c\u76f8\u4e92\u4e4b\u95f4\u662f\u72ec\u7acb\u7684")),l.a.createElement("h2",{id:"11mobx-\u5b9e\u6218"},l.a.createElement(r["AnchorLink"],{to:"#11mobx-\u5b9e\u6218","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"11.Mobx \u5b9e\u6218"),l.a.createElement("h3",{id:"1\u5b89\u88c5\u4f9d\u8d56"},l.a.createElement(r["AnchorLink"],{to:"#1\u5b89\u88c5\u4f9d\u8d56","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"1\uff09\u5b89\u88c5\u4f9d\u8d56"),l.a.createElement(o["a"],{code:"yarn add mobx mobx-react mobx-state-tree",lang:"js"}),l.a.createElement("h3",{id:"2\u5c01\u88c5-store"},l.a.createElement(r["AnchorLink"],{to:"#2\u5c01\u88c5-store","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"2\uff09\u5c01\u88c5 store"),l.a.createElement(o["a"],{code:"// homeStore.ts\nimport { types } from 'mobx-state-tree';\nimport { toJS } from 'mobx';\n\nimport { webapi } from '@/services/webapi';\n\nconst merchantIdItem = types.model('merchantIdItem', {\n  isOpen: types.optional(types.boolean, false),\n  merchantId: types.maybeNull(types.string),\n  name: types.maybeNull(types.string),\n  phone: types.maybeNull(types.string),\n  todoNum: types.maybeNull(types.string),\n});\n\nconst HomeStore = types\n  .model('HomeStore', {\n    merchantList: types.optional(types.array(merchantIdItem), []),\n  })\n  .views((self: any) => {\n    return {\n      get dataList() {\n        return toJS(self.merchantList);\n      },\n    };\n  })\n  .volatile(() => {\n    return {\n      index: -1,\n    };\n  })\n  .actions((self: any) => {\n    return {\n      setObject(data: any) {\n        Object.keys(data).forEach((key) => {\n          self[key] = data[key];\n        });\n        return self;\n      },\n      setObjectAsync(data: any) {\n        return new Promise((resolve) => {\n          Object.keys(data).forEach((key) => {\n            self[key] = data[key];\n          });\n          resolve(true);\n        });\n      },\n      query() {\n        self.setObject({ needUpdate: false });\n        return webapi({\n          preloader: true,\n        })\n          .then(() => {})\n          .catch(() => {});\n      },\n    };\n  });\n\nexport default HomeStore;",lang:"ts"}),l.a.createElement(o["a"],{code:"import { types } from 'mobx-state-tree';\nimport HomeStore from './homeStore';\nimport RetrievalStore from './retrievalStore';\n\nconst Stores = types\n  .model('Stores', {\n    home: types.optional(HomeStore, {}),\n    retrieval: types.optional(RetrievalStore, {}),\n  })\n  .views(() => {\n    return {};\n  });\n\nexport default Stores;",lang:"ts"}),l.a.createElement("h3",{id:"3\u6ce8\u5165-store"},l.a.createElement(r["AnchorLink"],{to:"#3\u6ce8\u5165-store","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"3\uff09\u6ce8\u5165 store"),l.a.createElement(o["a"],{code:"// App.js\nimport { Provider } from 'mobx-react';\nimport Store from '@/store';\n\nconst store = Store.create({});\n\nfunction App() {\n  return <Provider store={store}></Provider>;\n}",lang:"js"}),l.a.createElement("h3",{id:"4\u5c01\u88c5\u83b7\u53d6-store-\u7684\u65b9\u6cd5-\u81ea\u5b9a\u4e49-hook"},l.a.createElement(r["AnchorLink"],{to:"#4\u5c01\u88c5\u83b7\u53d6-store-\u7684\u65b9\u6cd5-\u81ea\u5b9a\u4e49-hook","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"4\uff09\u5c01\u88c5\u83b7\u53d6 store \u7684\u65b9\u6cd5-\u81ea\u5b9a\u4e49 hook"),l.a.createElement(o["a"],{code:"// useStore.ts\nimport * as React from 'react';\nimport { MobXProviderContext } from 'mobx-react';\nimport type { Instance } from 'mobx-state-tree';\nimport type Stores from '@/store';\n\nexport default function useStore() {\n  return React.useContext<Record<'store', Instance<typeof Stores>>>(\n    MobXProviderContext,\n  );\n}",lang:"ts"}),l.a.createElement("h3",{id:"5\u9875\u9762\u4f7f\u7528"},l.a.createElement(r["AnchorLink"],{to:"#5\u9875\u9762\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},l.a.createElement("span",{className:"icon icon-link"})),"5\uff09\u9875\u9762\u4f7f\u7528"),l.a.createElement(o["a"],{code:"// home.tsx\nimport { observer } from 'mobx-react';\nimport useStore from '@/hooks/useStore';\n\nconst Home: React.FC = observer(() => {\n  const {\n    store: { home },\n  } = useStore();\n});",lang:"ts"}))))},JjdP:function(e,n,t){"use strict";t.r(n),n["default"]={}},Zs1V:function(e){e.exports=JSON.parse("{}")}}]);