---
toc: menu
---

# 输入 URL 到页面渲染的整个流程

- 过程

  - DNS 解析：把域名解析成 IP 地址
  - TCP/IP 三次握手建立链接
  - 浏览器向 web 服务器发送 http 请求
  - 服务器处理并响应报文
  - 浏览器解析并渲染页面
  - 四次挥手断开连接：TCP 结束连接
  - 浏览器发生异步请求

## 1.什么是 URL？

- URL（Uniform Resource Locator），统一资源定位符，用于定位互联网上资源，俗称网址

## 2.域名解析（DNS）

- DNS 是基于 UDP 做的查询

### 1）为什么需要域名解析（也就是编码）

- 浏览器并不能直接通过域名找到对应的服务器，而是要通过 IP 地址访问

- 1.因为网络标准规定了 URL 只能是字母和数字，还有一些其它特殊符号，而且如果不转义会出现歧义

- 2.url 编码的规则是 utf-8

- 3.可以用 encodeURIComponent

- 4.encodeURIComponent 比 encodeURI 区别：
  - encodeURIComponent 编码范围更广，适合给参数编码
    encodeURI 适合给 URL 本身（locaion.origin）编码
  - 当然项目里一般都是用 qs 库去处理

### 2）什么是域名解析

- DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务
- DNS 是一个网络服务器，我们的域名解析简单来说就是在 DNS 上记录一条信息记录

### 3）DNS 解析过程

- DNS 解析过程会进行递归查询，分别依次尝试从以下途径，按顺序地获取该域名对应的 IP 地址：

  - 浏览器缓存

  - 系统缓存（用户操作系统 Hosts 文件 DNS 缓存）

  - 路由器缓存

  - 互联网服务提供商 DNS 缓存（联通、移动、电信等互联网服务提供商的 DNS 缓存服务器）

  - 根域名服务器

  - 顶级域名服务器

  - 主域名服务器

- DNS 解析过程会根据上述步骤进行递归查询，如果当前步骤没查到，则自动跳转到到下一步骤通过下一个 DNS 服务器进行查找。如果最终依然没找到，浏览器便会将页面响应为打开失败

- 在前后端联调过程中也常常需要配置 HOST，这个过程便是修改了浏览器缓存或是系统缓存。通过将特定域名指向我们自身的服务器 IP 地址，便可以实现通过域名访问本地环境、测试环境、预发布环境的服务器资源

### 4）为什么需要配置域名 HOST，而不直接使用 IP 地址进行访问

- 因为浏览器的同源策略会导致跨域问题

### 5）html 如何做 dns 优化

- 前端的 dns 优化，可以在 html 页面头部写入 dns 缓存地址，比如:

```html
<meta http-equiv="x-dns-prefetch-control" content="on" />
<link rel="dns-prefetch" href="http://bdimg.share.baidu.com" />
```

## 3.TCP/IP 三次握手建立链接

[链接](/base/internet/tcp#3建立连接三次握手)

## 4.浏览器向 web 服务器发送 http 请求

- 建立 TCP 连接后，开始向 Web 服务器发送 HTTP 请求报文
  - 请求方法包含 8 种：GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE
  - URL 即请求地址，由 <协议>：//<主机>：<端口>/<路径>?<参数> 组成
  - 协议版本即 http 版本号

## 5.服务器处理请求并返回 HTTP 报文

- 服务器接受到请求后，对相应的请求作出相应的处理，处理完成后并作出相应的 http 响应报文

## 6.浏览器解析渲染页面

- 1.根据 HTML 解析 DOM 树

  - 根据 HTML 的内容，将标签按照结构解析成为 DOM 树，DOM 树解析的过程是一个深度优先遍历。即先构建当前节点的所有子节点，再构建下一个兄弟节点
  - 在读取 HTML 文档，构建 DOM 树的过程中，若遇到 script 标签，则 DOM 树的构建会暂停，直至脚本执行完毕

- 2.根据 CSS 解析生成 CSS 规则树

  - 解析 CSS 规则树时 js 执行将暂停，直至 CSS 规则树就绪。
  - 浏览器在 CSS 规则树生成之前不会进行渲染。

- 3.结合 DOM 树和 CSS 规则树，生成渲染树

  - DOM 树和 CSS 规则树全部准备好了以后，浏览器才会开始构建渲染树。
  - 精简 CSS 并可以加快 CSS 规则树的构建，从而加快页面相应速度。

- 4.根据渲染树计算每一个节点的信息（布局）

  - 布局：通过渲染树中渲染对象的信息，计算出每一个渲染对象的位置和尺寸
  - 回流：在布局完成后，发现了某个部分发生了变化影响了布局，那就需要倒回去重新渲染。

- 5.根据计算好的信息绘制页面

  - 绘制阶段，系统会遍历呈现树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上。
  - 重绘：某个元素的背景颜色，文字颜色等，不影响元素周围或内部布局的属性，将只会引起浏览器的重绘。
  - 回流：某个元素的尺寸发生了变化，则需重新计算渲染树，重新渲染。

## 7.四次挥手断开连接：TCP 结束连接

[链接](/base/internet/tcp#5断开链接四次挥手四处握手)

## 8.浏览器发生异步请求

- 在 web2.0 时代，即使在页面渲染后客户端还是持续与服务器端通信，这个模式被称为 AJAX
- 事件循环

## 9.页面渲染优化

- HTML 文档结构层次尽量少，最好不深于六层；
- 脚本尽量后放，放在前即可；
- 少量首屏样式内联放在标签内；
- 样式结构层次尽量简单；
- 在脚本中尽量减少 DOM 操作，尽量缓存访问 DOM 的样式信息，避免过度触发回流；
- 减少通过 JavaScript 代码修改元素样式，尽量使用修改 class 名方式操作样式或动画；
- 动画尽量使用在绝对定位或固定定位的元素上；
- 隐藏在屏幕外，或在页面滚动时，尽量停止动画；
- 尽量缓存 DOM 查找，查找器尽量简洁；
- 涉及多域名的网站，可以开启域名预解析
