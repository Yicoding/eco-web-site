---
toc: menu
---

# 输入 URL 到页面渲染的整个流程

- 过程

  - DNS 解析：把域名解析成 IP 地址
  - TCP/IP 三次握手建立链接
  - 浏览器向 web 服务器发送 http 请求
  - 服务器处理并响应报文
  - 浏览器解析并渲染页面
  - 四次挥手断开连接：TCP 结束连接
  - 浏览器发生异步请求

## 1.什么是 URL？

- URL（Uniform Resource Locator），统一资源定位符，用于定位互联网上资源，俗称网址

## 2.域名解析（DNS）

- DNS 是基于 UDP 做的查询

### 1）为什么需要域名解析（也就是编码）

- 浏览器并不能直接通过域名找到对应的服务器，而是要通过 IP 地址访问

- 1.因为网络标准规定了 URL 只能是字母和数字，还有一些其它特殊符号，而且如果不转义会出现歧义

- 2.url 编码的规则是 utf-8

- 3.可以用 encodeURIComponent

- 4.ncodeURIComponent 比 encodeURI 区别：
  - encodeURIComponent 编码范围更广，适合给参数编码
    encodeURI 适合给 URL 本身（locaion.origin）编码
  - 当然项目里一般都是用 qs 库去处理

### 2）什么是域名解析

- DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务
- DNS 是一个网络服务器，我们的域名解析简单来说就是在 DNS 上记录一条信息记录

### 3）DNS 解析过程：

- 1.在浏览器中输入www.qq.com域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析
- 2.如果 hosts 里没有这个域名的映射，则查找本地 DNS 解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析
- 3.如果本地 DNS 服务器本地区域文件与缓存解析都失效，则根据本地 DNS 服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地 DNS 就把请求发至 13 台根 DNS，根 DNS 服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个 IP。本地 DNS 服务器收到 IP 信息后，将会联系负责.com 域的这台服务器。这台负责.com 域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com 域的下一级 DNS 服务器地址(qq.com)给本地 DNS 服务器。当本地 DNS 服务器收到这个地址后，就会找 qq.com 域服务器，重复上面的动作，进行查询，直至找到www.qq.com主机
- 4.如果用的是转发模式，此 DNS 服务器就会把请求转发至上一级 DNS 服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根 DNS 或把转请求转至上上级，以此循环。不管是本地 DNS 服务器用是是转发，还是根提示，最后都是把结果返回给本地 DNS 服务器，由此 DNS 服务器再返回给客户机

### 4）html 如何做 dns 优化

- 前端的 dns 优化，可以在 html 页面头部写入 dns 缓存地址，比如:

```html
<meta http-equiv="x-dns-prefetch-control" content="on" />
<link rel="dns-prefetch" href="http://bdimg.share.baidu.com" />
```

## 3.TCP/IP 三次握手建立链接

[链接](/base/internet/tcp#3建立连接三次握手)

## 4.浏览器向 web 服务器发送 http 请求

- 建立 TCP 连接后，开始向 Web 服务器发送 HTTP 请求报文
  - 请求方法包含 8 种：GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE
  - URL 即请求地址，由 <协议>：//<主机>：<端口>/<路径>?<参数> 组成
  - 协议版本即 http 版本号

## 5.服务器处理请求并返回 HTTP 报文

- 服务器接受到请求后，对相应的请求作出相应的处理，处理完成后并作出相应的 http 响应报文

## 6.浏览器解析渲染页面

- 1.根据 HTML 解析 DOM 树

  - 根据 HTML 的内容，将标签按照结构解析成为 DOM 树，DOM 树解析的过程是一个深度优先遍历。即先构建当前节点的所有子节点，再构建下一个兄弟节点
  - 在读取 HTML 文档，构建 DOM 树的过程中，若遇到 script 标签，则 DOM 树的构建会暂停，直至脚本执行完毕

- 2.根据 CSS 解析生成 CSS 规则树

  - 解析 CSS 规则树时 js 执行将暂停，直至 CSS 规则树就绪。
  - 浏览器在 CSS 规则树生成之前不会进行渲染。

- 3.结合 DOM 树和 CSS 规则树，生成渲染树

  - DOM 树和 CSS 规则树全部准备好了以后，浏览器才会开始构建渲染树。
  - 精简 CSS 并可以加快 CSS 规则树的构建，从而加快页面相应速度。

- 4.根据渲染树计算每一个节点的信息（布局）

  - 布局：通过渲染树中渲染对象的信息，计算出每一个渲染对象的位置和尺寸
  - 回流：在布局完成后，发现了某个部分发生了变化影响了布局，那就需要倒回去重新渲染。

- 5.根据计算好的信息绘制页面

  - 绘制阶段，系统会遍历呈现树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上。
  - 重绘：某个元素的背景颜色，文字颜色等，不影响元素周围或内部布局的属性，将只会引起浏览器的重绘。
  - 回流：某个元素的尺寸发生了变化，则需重新计算渲染树，重新渲染。

## 7.四次挥手断开连接：TCP 结束连接

[链接](/base/internet/tcp#5断开链接四次挥手四处握手)

## 8.浏览器发生异步请求

- 在 web2.0 时代，即使在页面渲染后客户端还是持续与服务器端通信，这个模式被称为 AJAX
- 事件循环

## 9.页面渲染优化

- HTML 文档结构层次尽量少，最好不深于六层；
- 脚本尽量后放，放在前即可；
- 少量首屏样式内联放在标签内；
- 样式结构层次尽量简单；
- 在脚本中尽量减少 DOM 操作，尽量缓存访问 DOM 的样式信息，避免过度触发回流；
- 减少通过 JavaScript 代码修改元素样式，尽量使用修改 class 名方式操作样式或动画；
- 动画尽量使用在绝对定位或固定定位的元素上；
- 隐藏在屏幕外，或在页面滚动时，尽量停止动画；
- 尽量缓存 DOM 查找，查找器尽量简洁；
- 涉及多域名的网站，可以开启域名预解析
